App.Controllers.UsergroupsEditController=Frontend.AppController.extend({components:['Ajaxloader','Aco'],_initialize:function(){var self=this;this.Ajaxloader.setup();this.Aco.setup()},});App.Controllers.UsergroupsAddController=Frontend.AppController.extend({components:['Ajaxloader','Aco'],_initialize:function(){var self=this;this.Ajaxloader.setup();this.Aco.setup()},});App.Controllers.HostsEditDetailsController=Frontend.AppController.extend({_initialize:function(){$('#HostTags').tagsinput();$('.parent_checkbox').change(function(){var $this=$(this);if($this.prop('checked')){var $input=$this.parents('.editHostDetailFormInput').children('.scope').find(':input');$($input).each(function(key,input){$_input=$(input);if($_input.hasClass('chosen')){$_input.prop('disabled',!1);$_input.trigger("chosen:updated")}else{$_input.prop('disabled',!1)}})}else{var $input=$this.parents('.editHostDetailFormInput').children('.scope').find(':input');$($input).each(function(key,input){$_input=$(input);if($_input.hasClass('chosen')){$_input.prop('disabled',!0);$_input.val('').removeAttr('selected');$_input.trigger("chosen:updated")}else{$_input.val('').removeAttr('checked');$_input.prop('disabled',!0)}})}})}});App.Controllers.ExportsIndexController=Frontend.AppController.extend({$exportLog:null,worker:null,components:['Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var _self=this;$('#selectAllSat').click(function(){$('.sync_instance').each(function(key,obj){$(obj).prop('checked',!0)})});$('#deselectAllSat').click(function(){$('.sync_instance').each(function(key,obj){$(obj).prop('checked',!1)})});$('#saveInstacesForSync').click(function(){_self.saveInstacesForSync()});this.worker=function(){var self=this;$.ajax({url:'/exports/broadcast.json',cache:!1,type:"GET",success:function(response){var $exportLog=$('#exportLog');for(var key in response.exportRecords){var $exportLogEntry=$exportLog.children('#'+key);if($exportLogEntry.length==0){if(response.exportRecords[key].finished==0){var html='<div id="'+key+'" data-finished="0"><i class="fa fa-spin fa-refresh"></i> <span>'+response.exportRecords[key].text+'</span></div>'}else{if(response.exportRecords[key].successfully==1){var html='<div id="'+key+'" data-finished="1"><i class="fa fa-check text-success"></i> <span>'+response.exportRecords[key].text+'</span></div>'}else{var html='<div id="'+key+'" data-finished="1"><i class="fa fa-times text-danger"></i> <span>'+response.exportRecords[key].text+'</span></div>'}}
$exportLog.append(html)}else{if(response.exportRecords[key].finished==0){if($exportLogEntry.data('finished')!=0){var html='<i class="fa fa-spin fa-refresh"></i> <span>'+response.exportRecords[key].text+'</span>';$exportLogEntry.html(html)}}else{if(response.exportRecords[key].successfully==1){var html='<i class="fa fa-check text-success"></i> <span>'+response.exportRecords[key].text+'</span>'}else{var html='<i class="fa fa-times text-danger"></i> <span>'+response.exportRecords[key].text+'</span>'}
$exportLogEntry.html(html)}}}
if(response.exportFinished.finished==!0){if(response.exportFinished.successfully==!0){$('#exportSuccessfully').show()}
if(response.exportFinished.successfully==!1){$('#exportError').show();for(var key in response.exportRecords){if(response.exportRecords[key].task=='export_verify_new_configuration'){if(response.exportRecords[key].finished==1&&response.exportRecords[key].successfully==0){self.verify()}}}}}},complete:function(response){if(response.responseJSON.exportFinished.finished==!1){setTimeout(self.worker,1000)}}})}.bind(this);if(this.getVar('exportRunning')==!0){$('#exportInfo').show();this.worker()}
$('#launchExport').click(function(){var self=this;$('#exportInfo').show();$('#launchExport').parents('.formactions').remove();var createBackup=1;if($('#CreateBackup').prop('checked')==!1||$('#CreateBackup').prop('checked')==null){createBackup=0}
var instacesToExport=[];$('.sync_instance').each(function(key,obj){if($(obj).prop('checked')){instacesToExport.push($(obj).attr('instance'))}});$.ajax({url:'/exports/launchExport/'+createBackup+'.json',cache:!1,type:"GET",data:{instances:instacesToExport},success:function(response){if(response.export.exportRunning==!0){$('#exportRunning').show();$('#exportInfo').show();$('#launchExport').parents('.formactions').remove()}
self.worker()},complete:function(){}})}.bind(this))},verify:function(){var $verifyOutput=$('#verifyOutput');var RegExObject=new RegExp('('+this.getVar('uuidRegEx')+')','g');$('#verifyError').show();$.ajax({url:'/exports/verifyConfig.json',cache:!1,type:"GET",success:function(response){for(var key in response.result.output){var line=response.result.output[key];line=line.replace(RegExObject,'<a href="/forward/index/uuid:$1/action:edit">$1</a>');var _class='txt-color-blueDark';if(line.match('Warning')){_class='txt-color-orangeDark'}
if(line.match('Error')){_class='txt-color-red'}
$verifyOutput.append('<div class="'+_class+'">'+line+'</div>')}},complete:function(){}})},saveInstacesForSync:function(){this.Ajaxloader.show();var instacesToExport=[];$('.sync_instance').each(function(key,obj){if($(obj).prop('checked')){instacesToExport.push($(obj).attr('instance'))}});var self=this;$.ajax({url:'/exports/saveInstanceConfigSyncSelection.json',cache:!1,type:"GET",data:{instances:instacesToExport},success:function(response){self.Ajaxloader.hide()},complete:function(){}})}});App.Controllers.BackupsIndexController=Frontend.AppController.extend({$exportLog:null,worker:null,components:['Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var content="";var finish=!0;var self=this;var error=!1;self.worker=function(){$.ajax({type:"GET",cache:!1,url:"/backups/checkBackupFinished.json",success:function(response){if(jQuery.type(response)==="string"){$('#warningMessage').html("You have been restored an old Backup. You have to run openitcockpit-update and set the user rights correctly.");$('#backupWarning').show()}else{var $backupLog=$('#backupLog');if(response.backupFinished.finished==!1&&error==!1){setTimeout(self.worker,1000);var html='<div data-finished="0"><i class="fa fa-spin fa-refresh"></i> <span>'+content+' is running</span>';$backupLog.html(html);finish=!1}else if(response.backupFinished.error==!0){var html='<div data-finished="0"><i class="fa fa-close text-danger"></i> <span>'+content+' has caused an error</span>';$backupLog.html(html);$('#errorMessage').html(content+" was not successfully finished");$('#backupError').show();finish=!0}else if(error==!0){var html='<div data-finished="0"><i class="fa fa-close text-danger"></i> <span>'+content+' has caused an error</span>';$backupLog.html(html);finish=!0}else{var html='<div data-finished="1"><i class="fa fa-check text-success"></i> <span>'+content+' is finished</span>';$backupLog.html(html);$('#successMessage').html(content+" successfully done.");$('#backupSuccessfully').show();var backupfiles=$('#backupfile');backupfiles.find('option').remove();$.each(response.backupFinished.backup_files,function(val,text){backupfiles.append("<option value="+val+">"+text+"</option>")});finish=!0;backupfiles.trigger("chosen:updated")}}},complete:function(response){var $backupLog=$('#backupLog');if(jQuery.type(response)==="string"){var html='<div data-finished="1"><i class="fa fa-check text-success"></i> <span>'+content+' is finished</span>';$backupLog.html(html);$('#warningMessage').html("You have been restored an old Backup. You have to run openitcockpit-update and set the user rights correctly.");$('#backupWarning').show()}else{if(typeof response.backupFinished==='undefined'){console.log("LEER")}else{if(response.backupFinished.finished==!1&&error==!1){setTimeout(self.worker,1000);var html='<div data-finished="0"><i class="fa fa-spin fa-refresh"></i> <span>'+content+' is running</span>';$backupLog.html(html);finish=!1}else if(response.backupFinished.error==!0){var html='<div data-finished="0"><i class="fa fa-close text-danger"></i> <span>'+content+' has caused an error</span>';$backupLog.html(html);$('#errorMessage').html(content+" was not successfully finished");$('#backupError').show();finish=!0}else if(error==!0){var html='<div data-finished="0"><i class="fa fa-close text-danger"></i> <span>'+content+' has caused an error</span>';$backupLog.html(html);finish=!0}else{var html='<div data-finished="1"><i class="fa fa-check text-success"></i> <span>'+content+' is finished</span>';$backupLog.html(html);$('#successMessage').html(content+" successfully done.");$('#backupSuccessfully').show();var backupfiles=$('#backupfile');backupfiles.find('option').remove();$.each(response.backupFinished.backup_files,function(val,text){backupfiles.append("<option value="+val+">"+text+"</option>")});finish=!0;backupfiles.trigger("chosen:updated")}}}}})}.bind(this);if(finish==!1&&error==!1){self.worker()}
$('#backup').click(function(){$('#backupSuccessfully').hide();$('#backupError').hide();$('#backupWarning').hide();$('#backupLog').empty();var fileForBackup=$('#filenameForBackup').val();content="Backup";finish=!1;$.ajax({url:'/backups/backup.json',cache:!1,type:"GET",data:{filename:fileForBackup},success:function(response){if(response.backup.error==!0){error=!0;finish=!0;$('#errorMessage').html("Backup was not successful. Your filename is invalid.");$('#backupError').show()}else{self.worker()}},complete:function(){}})}.bind(this));$('#restore').click(function(){$('#backupSuccessfully').hide();$('#backupError').hide();$('#backupWarning').hide();$('#backupLog').empty();var fileForBackup=$('#backupfile').val();var filenameParts=fileForBackup.split("/");var r=confirm("Are you sure to restore this backupfile "+filenameParts[5]+"?");if(r==!0){finish=!1;content="Restore";$.ajax({url:'/backups/restore.json',cache:!1,type:"GET",data:{backupfile:fileForBackup},success:function(response){self.worker()},complete:function(){}})}}.bind(this));$('#delete').click(function(){$('#backupSuccessfully').hide();$('#backupError').hide();$('#backupWarning').hide();$('#backupLog').empty();var fileToDelete=$('#backupfile').val();var filenameParts=fileToDelete.split("/");var r=confirm("Are you sure to delete this backupfile "+filenameParts[5]+"?");if(r==!0){$.ajax({url:'/backups/deleteBackupFile.json',cache:!1,type:"GET",data:{fileToDelete:fileToDelete},success:function(response){if(response.success.result==!0){$('#successMessage').html("Backupfile "+filenameParts[5]+" successfully deleted.");$('#backupSuccessfully').show();var backupfiles=$('#backupfile');backupfiles.find('option').remove();$.each(response.success.backup_files,function(val,text){backupfiles.append("<option value="+val+">"+text+"</option>")});backupfiles.trigger("chosen:updated");finish=!0}else{$('#errorMessage').html("Backupfile "+filenameParts[5]+" could not deleted.");$('#backupError').show();finish=!0}},complete:function(){}})}}.bind(this))}});App.Controllers.QrIndexController=Frontend.AppController.extend({components:['Qr'],_initialize:function(){this.Qr._printPage(this.getVar('qr_url'),this.getVar('qr_width'),this.getVar('qr_height'))}});App.Controllers.PacketmanagerIndexController=Frontend.AppController.extend({$advancedPackagingToolTextarea:null,$packageManagerTextarea:null,components:['WebsocketSudo'],_initialize:function(){var self=this;$('#tagSearch').keyup(function(){var searchString=$(this).val().toLowerCase();if(searchString!=''){$('.tags').each(function(key,object){var $object=$(object);if(!$object.html().toLowerCase().match(searchString)){$object.parents('.jarviswidget').hide()}})}else{$('.tags').parents('.jarviswidget').show()}});self.$advancedPackagingToolTextarea=$('.advanced-packaging-tool textarea');self.$packageManagerTextarea=$('#package-manager-log textarea');self.WebsocketSudo.setup(self.getVar('websocket_url'),self.getVar('akey'));self.WebsocketSudo._errorCallback=function(){$('#error_msg').html('<div class="alert alert-danger alert-block"><a href="#" data-dismiss="alert" class="close">×</a><h5 class="alert-heading"><i class="fa fa-warning"></i> Error</h5>Could not connect to SudoWebsocket Server</div>')}
self.WebsocketSudo.connect();self.WebsocketSudo._success=function(e){$('#package-manager-log').on('hidden.bs.modal',function(e){document.location=document.location});$('.uninstall').click(function(){var packageName=$(this).data('package-name');if(!packageName){return}
if($(this).data('package-enterprise')==1){self.WebsocketSudo.send(self.WebsocketSudo.toJson('5238f8e57e72e81d44119a8ffc3f98ea',{name:$(this).data('package-apt-name')}))}else{self.WebsocketSudo.send(self.WebsocketSudo.toJson('package_uninstall',{name:packageName}))}});$('.install').click(function(){var $this=$(this);var packageUrl=$this.data('package-url');var packageName=$this.data('package-name');if(!packageUrl||!packageName){return}
if($(this).data('package-enterprise')==0){self.WebsocketSudo.send(self.WebsocketSudo.toJson('package_install',{url:packageUrl,name:packageName}))}else{self.WebsocketSudo.send(self.WebsocketSudo.toJson('d41d8cd98f00b204e9800998ecf8427e',{name:$(this).data('package-apt-name')}))}});$('#apt_update').removeAttr('disabled');$('#apt_update').click(function(){self.WebsocketSudo.send(self.WebsocketSudo.toJson('apt_get_update',''))})};self.WebsocketSudo._callback=function(transmitted){if(transmitted.category&&transmitted.category==='action'){switch(transmitted.payload){case 'reload':document.location=document.location;break;default:break}}
switch(transmitted.task){case 'package_uninstall':case 'package_install':case '5238f8e57e72e81d44119a8ffc3f98ea':case 'd41d8cd98f00b204e9800998ecf8427e':if(transmitted.category!='notification'){break}
$('#package-manager-log').modal('show');var text=transmitted.payload;if(!text.match(/\n$/)){text+="\n"}
self.$packageManagerTextarea.append(text);var value=self.$packageManagerTextarea[0].scrollHeight-self.$packageManagerTextarea.height();self.$packageManagerTextarea.scrollTop(value);break;default:self.$advancedPackagingToolTextarea.append(transmitted.payload);var value=self.$advancedPackagingToolTextarea[0].scrollHeight-self.$advancedPackagingToolTextarea.height();self.$advancedPackagingToolTextarea.scrollTop(value)}}}});App.Controllers.AutoreportsAddStepTwoController=Frontend.AppController.extend({components:['Highlight','Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var self=this;if($('#AutoreportHostId').val()){self.showConfigurationTable($('#AutoreportHostId').val())}
$('#AutoreportHostId').chosen().change(function(element,hit){self.showConfigurationTable($('#AutoreportHostId').val());if(!hit.selected){$('.host_'+hit.deselected).remove()}else{self.loadServices(hit.selected)}});$('input:radio[id^="AutoreportGraphSettings"]').change(function(){self.setAllGraphSettings($(this).val())});$('[class*=" all_select_"]').click(function(){self.selectedAll($(this))});$('#AutoreportOutage').bind({keypress:function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return!1}},keyup:function(){self.filledAll($(this))}});$('.outage').bind({keypress:function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return!1}},})},loadServices:function(host_id){this.Ajaxloader.show();$.ajax({url:"/autoreport_module/autoreports/hostAndServicesByHostId/"+encodeURIComponent(host_id),type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){this.Ajaxloader.hide();$('#HostServicesSettings').append(response.responseText)}.bind(this)})},showConfigurationTable:function(show_values){if(show_values){$('#HostServicesSettings').removeClass('hidden')}else{$('#HostServicesSettings').addClass('hidden')}},selectedAll:function(element){var col=element.closest("td").index();var row=element.closest("tr").index();var rowCount=$("#HostServicesSettings tr").length;var startRow=row+1;var checked=(element.attr('class').replace(/[-\s\w]*?([-\w]+)\s?$/,'$1')=='all_select_true')?!0:!1;for(i=startRow;i<rowCount;i++){if($("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="checkbox"]:not(:disabled)').length){$("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="checkbox"]').prop('checked',checked)}}},filledAll:function(element){var col=element.closest("td").index();var row=element.closest("tr").index();var rowCount=$("#HostServicesSettings tr").length;var startRow=row+1;for(i=startRow;i<rowCount;i++){if($("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="text"]').length){$("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="text"]').val(element.val())}}},setAllGraphSettings:function(selectedValue){$('input:radio:enabled[id^="AutoreportHost"]').not('[id$="GraphSettings'+selectedValue+'"]').prop('checked',!1);$('input:radio:enabled[id^="AutoreportHost"][id$="GraphSettings'+selectedValue+'"]').prop('checked',!0)}});App.Controllers.AutoreportsEditStepTwoController=Frontend.AppController.extend({components:['Highlight','Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var self=this;if($('#AutoreportHostId').val()){self.showConfigurationTable($('#AutoreportHostId').val())}
$('#AutoreportHostId').chosen().change(function(element,hit){self.showConfigurationTable($('#AutoreportHostId').val());if(!hit.selected){$('.host_'+hit.deselected).remove()}else{self.loadServices(hit.selected)}});$('input:radio[id^="AutoreportGraphSettings"]').change(function(){self.setAllGraphSettings($(this).val())});$('[class*=" all_select_"]').click(function(){self.selectedAll($(this))});$('#AutoreportOutage').bind({keypress:function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return!1}},keyup:function(){self.filledAll($(this))}});$('.outage').bind({keypress:function(e){if(e.which!=8&&e.which!=0&&(e.which<48||e.which>57)){return!1}},})},loadServices:function(host_id){this.Ajaxloader.show();$.ajax({url:"/autoreport_module/autoreports/hostAndServicesByHostId/"+encodeURIComponent(host_id),type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){this.Ajaxloader.hide();$('#HostServicesSettings').append(response.responseText)}.bind(this)})},showConfigurationTable:function(show_values){if(show_values){$('#HostServicesSettings').removeClass('hidden')}else{$('#HostServicesSettings').addClass('hidden')}},selectedAll:function(element){var col=element.closest("td").index();var row=element.closest("tr").index();var rowCount=$("#HostServicesSettings tr").length;var startRow=row+1;var checked=(element.attr('class').replace(/[-\s\w]*?([-\w]+)\s?$/,'$1')=='all_select_true')?!0:!1;for(i=startRow;i<rowCount;i++){if($("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="checkbox"]:not(:disabled)').length){$("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="checkbox"]').prop('checked',checked)}}},filledAll:function(element){var col=element.closest("td").index();var row=element.closest("tr").index();var rowCount=$("#HostServicesSettings tr").length;var startRow=row+1;for(i=startRow;i<rowCount;i++){if($("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="text"]').length){$("#HostServicesSettings tr").eq(i).children("td:nth-child("+(col+1)+")").find('input[type="text"]').val(element.val())}}},setAllGraphSettings:function(selectedValue){$('input:radio:enabled[id^="AutoreportHost"]').not('[id$="GraphSettings'+selectedValue+'"]').prop('checked',!1);$('input:radio:enabled[id^="AutoreportHost"][id$="GraphSettings'+selectedValue+'"]').prop('checked',!0)}});App.Controllers.AutoreportsAddStepOneController=Frontend.AppController.extend({components:['Ajaxloader','ContainerSelectbox'],_initialize:function(){var self=this;this.Ajaxloader.setup();this.ContainerSelectbox.setup(this.Ajaxloader);this.ContainerSelectbox.addContainerEventListener({selectBoxSelector:'#AutoreportContainerId',ajaxUrl:'/autoreport_module/autoreports/loadElementsByContainerIdStepOne/:selectBoxValue:.json',fieldTypes:{timeperiods:'#AutoreportTimeperiodId',users:'#AutoreportReportUser',calendars:'#AutoreportCalendarId'},dataPlaceholderEmpty:self.getVar('data_placeholder_empty'),dataPlaceholder:self.getVar('data_placeholder'),event:'change.hostContainer'});$("#AutoreportReportStartDate").datepicker({changeMonth:!0,numberOfMonths:3,todayHighlight:!0,weekStart:1,calendarWeeks:!0,autoclose:!0,format:'dd.mm.yyyy',prevText:'<i class="fa fa-chevron-left"></i>',nextText:'<i class="fa fa-chevron-right"></i>'});$('input[type="checkbox"]#AutoreportUseStartTime').change(function(){this.checkUseStartTime()}.bind(this));$('input[type="checkbox"]#AutoreportMinAvailabilityOn').change(function(){this.checkMinAvailability()}.bind(this));$('input[type="checkbox"]#AutoreportMaxOutages').change(function(){this.checkMaxOutages()}.bind(this));$('input[id^=AutoreportMinAvailabilityIn]').focus(function(){this.clearInputField($(document.activeElement).attr("id"))}.bind(this));$('input[type="checkbox"]#AutoreportConsiderHolidays').change(function(){this.checkConsiderHolidays()}.bind(this));this.checkUseStartTime();this.checkMinAvailability();this.checkMaxOutages();this.checkConsiderHolidays()},checkUseStartTime:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportUseStartTime').prop('checked')){disabled=!0;$('#AutoreportReportStartDate').val('')}
$('#AutoreportReportStartDate').prop('disabled',disabled)},checkMinAvailability:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportMinAvailabilityOn').prop('checked')){disabled=!0;$('#AutoreportMinAvailabilityInPercent').val('');$('#AutoreportMinAvailabilityInMinutes').val('')}
$('#AutoreportMinAvailabilityInPercent').prop('disabled',disabled);$('#AutoreportMinAvailabilityInMinutes').prop('disabled',disabled)},checkMaxOutages:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportMaxOutages').prop('checked')){disabled=!0;$('#AutoreportMaxNumberOfOutages').val('')}
$('#AutoreportMaxNumberOfOutages').prop('disabled',disabled)},clearInputField:function(inputFieldId){var regex=new RegExp("^"+inputFieldId,'i');$('input[type=text][id^=AutoreportMinAvailabilityIn]').each(function(intKey,InputObject){if(!InputObject.id.match(regex)){$('#'+InputObject.id).val('')}})},checkConsiderHolidays:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportConsiderHolidays').prop('checked')){disabled=!0}
$('#AutoreportCalendarId').prop('disabled',disabled).trigger('chosen:updated')},});App.Controllers.AutoreportsEditStepOneController=Frontend.AppController.extend({components:['Ajaxloader','ContainerSelectbox'],_initialize:function(){var self=this;this.Ajaxloader.setup();this.ContainerSelectbox.setup(this.Ajaxloader);this.ContainerSelectbox.addContainerEventListener({selectBoxSelector:'#AutoreportContainerId',ajaxUrl:'/autoreport_module/autoreports/loadElementsByContainerIdStepOne/:selectBoxValue:.json',fieldTypes:{timeperiods:'#AutoreportTimeperiodId',users:'#AutoreportReportUser',calendars:'#AutoreportCalendarId'},dataPlaceholderEmpty:self.getVar('data_placeholder_empty'),dataPlaceholder:self.getVar('data_placeholder'),event:'change.hostContainer'});$("#AutoreportReportStartDate").datepicker({changeMonth:!0,numberOfMonths:3,todayHighlight:!0,weekStart:1,calendarWeeks:!0,autoclose:!0,format:'dd.mm.yyyy',prevText:'<i class="fa fa-chevron-left"></i>',nextText:'<i class="fa fa-chevron-right"></i>',});$('input[type="checkbox"]#AutoreportUseStartTime').change(function(){this.checkUseStartTime()}.bind(this));$('input[type="checkbox"]#AutoreportMinAvailabilityOn').change(function(){this.checkMinAvailability()}.bind(this));$('input[type="checkbox"]#AutoreportMaxOutages').change(function(){this.checkMaxOutages()}.bind(this));$('input[id^=AutoreportMinAvailabilityIn]').focus(function(){this.clearInputField($(document.activeElement).attr("id"))}.bind(this));$('input[type="checkbox"]#AutoreportConsiderHolidays').change(function(){this.checkConsiderHolidays()}.bind(this));this.checkUseStartTime();this.checkMinAvailability();this.checkMaxOutages();this.checkConsiderHolidays()},checkUseStartTime:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportUseStartTime').prop('checked')){disabled=!0;$('#AutoreportReportStartDate').val('')}
$('#AutoreportReportStartDate').prop('disabled',disabled)},checkMinAvailability:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportMinAvailabilityOn').prop('checked')){disabled=!0;$('#AutoreportMinAvailabilityInPercent').val('');$('#AutoreportMinAvailabilityInMinutes').val('')}
$('#AutoreportMinAvailabilityInPercent').prop('disabled',disabled);$('#AutoreportMinAvailabilityInMinutes').prop('disabled',disabled)},checkMaxOutages:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportMaxOutages').prop('checked')){disabled=!0;$('#AutoreportMaxNumberOfOutages').val('')}
$('#AutoreportMaxNumberOfOutages').prop('readonly',disabled)},clearInputField:function(inputFieldId){var regex=new RegExp("^"+inputFieldId,'i');$('input[type=text][id^=AutoreportMinAvailabilityIn]').each(function(intKey,InputObject){if(!InputObject.id.match(regex)){$('#'+InputObject.id).val('')}})},checkConsiderHolidays:function(){var disabled=null;if(!$('input[type="checkbox"]#AutoreportConsiderHolidays').prop('checked')){disabled=!0}
$('#AutoreportCalendarId').prop('disabled',disabled).trigger('chosen:updated')},});App.Controllers.AutoreportsCreateReportController=Frontend.AppController.extend({_initialize:function(){$("#AutoreportStartDate").datepicker({changeMonth:!0,numberOfMonths:3,todayHighlight:!0,weekStart:1,calendarWeeks:!0,autoclose:!0,format:'dd.mm.yyyy',prevText:'<i class="fa fa-chevron-left"></i>',nextText:'<i class="fa fa-chevron-right"></i>',});$("#AutoreportEndDate").datepicker({changeMonth:!0,numberOfMonths:3,todayHighlight:!0,weekStart:1,calendarWeeks:!0,autoclose:!0,format:'dd.mm.yyyy',prevText:'<i class="fa fa-chevron-left"></i>',nextText:'<i class="fa fa-chevron-right"></i>',})},});App.Controllers.ChatIndexController=Frontend.AppController.extend({$chatUsers:null,$filterInput:null,$chatBody:null,$chatContainer:null,components:['WebsocketChat'],_initialize:function(){this.$chatUsers=this.$('#chat-users');this.$filterInput=this.$('#filter-chat-list');this.$chatBody=this.$('#chat-body');this.$chatContainer=this.$('#chat-container');this.$chatContainer.find('.chat-list-open-close').click(this._onChatListToggle.bind(this));this._setupChatListFilter();this.WebsocketChat.setup(this.$('.chat-widget'),this.getVar('websocket_url'));this.WebsocketChat._errorCallback=function(){$('#error_msg').html('<div class="alert alert-danger alert-block"><a href="#" data-dismiss="alert" class="close">×</a><h5 class="alert-heading"><i class="fa fa-warning"></i> Error</h5>Could not connect to Chat Server</div>')}
this.WebsocketChat.new_message=this.getVar('new_message');this.WebsocketChat.setUsername(this.getVar('username'));this.WebsocketChat.setUserId(this.getVar('user_id'));this.WebsocketChat.connect()},_onChatListToggle:function(){this.$chatContainer.toggleClass('open')},_setupChatListFilter:function(){jQuery.expr[':'].Contains=function(a,i,m){return(a.textContent||a.innerText||"").toUpperCase().indexOf(m[3].toUpperCase())>=0};this.$filterInput.change(function(e){var filter=$(e.currentTarget).val();if(filter){this.$chatUsers.find("a:not(:Contains("+filter+"))").parent().slideUp();this.$chatUsers.find("a:Contains("+filter+")").parent().slideDown()}else{this.$chatUsers.find("li").slideDown()}
return!1}.bind(this)).keyup(function(){$(this).change()})}});App.Controllers.DesignEditController=Frontend.AppController.extend({_initialize:function(){self=this;var primaryColor='#3a3633';var secondaryColor='#474544';var navigationColorFade='93';var navigationFontColor='#c0bbb7';var navigationFontColorHover='#ffffff';var primaryFontColor='#333333';var primaryFontColorHeader='#333333';var bodyBackgroundColor='#eeeeef';var bodyPageHeadlineColor='#4c4f53';var windowHeaderBackground='#ffffff';var windowBorderColor='#C2C2C2';var windowBodyColor='#ffffff';var tableOddColor='#f9f9f9';var tableHoverColor='#f5f5f5';var mainHeaderBackgroundColor='#eaeaea';var mainHeaderTextColor='#6D6A69';var primarySpectrum=this.getSpectrum('#DesignPrimary',primaryColor,function(tinycolor){var hexColor=tinycolor.toHexString();var asideStyle=document.getElementById('left-panel').style;asideStyle.background='linear-gradient(to right, '+hexColor+'  '+navigationColorFade+'%, '+secondaryColor+'  100%)';primaryColor=hexColor});var secondarySpectrum=this.getSpectrum('#DesignSecondary',secondaryColor,function(tinycolor){var hexColor=tinycolor.toHexString();var ribbonStyle=document.getElementById('ribbon').style;ribbonStyle.background=hexColor;secondaryColor=hexColor;var asideStyle=document.getElementById('left-panel').style;asideStyle.background='linear-gradient(to right, '+primaryColor+'  '+navigationColorFade+'%, '+secondaryColor+'  100%)'});var handleSilder=function(ev){if(ev.value==null){ev.value=0}
navigationColorFade=parseInt(ev.value,10);var asideStyle=document.getElementById('left-panel').style;asideStyle.background='linear-gradient(to right, '+primarySpectrum.spectrum("get").toHexString()+'  '+navigationColorFade+'%, '+secondarySpectrum.spectrum("get").toHexString()+'  100%)'};var $slider=$('input.slider');$slider.slider();$slider.slider('on','slide',handleSilder);$slider.slider('on','slideStop',handleSilder);var navigationFontSpectrum=this.getSpectrum('#DesignFont-color-nav',navigationFontColor,function(tinycolor){var hexColor=tinycolor.toHexString();navigationFontColor=hexColor;$('nav ul li a').css('color',hexColor);var breadcrumbs=$('#ribbon .breadcrumb a');for(var key=0;key<breadcrumbs.length;key++){breadcrumbs[key].style.setProperty('color',hexColor,'important')}});var navigationFontHoverSpectrum=this.getSpectrum('#DesignFont-color-nav-hover',navigationFontColorHover,function(tinycolor){var hexColor=tinycolor.toHexString();navigationFontColorHover=hexColor;$('nav ul li a').hover(function(event){if(event.type==='mouseenter'){$(this).css('color',hexColor)}else{$(this).css('color',navigationFontColor)}});var $parentMenuEntry=$('nav ul .open a');var $currentMenuEntry=$('nav ul .active a');$parentMenuEntry.hover(function(event){$parentMenuEntry[0].style.setProperty('color',hexColor,'important')});$currentMenuEntry.hover(function(event){$currentMenuEntry[0].style.setProperty('color',hexColor,'important')});$parentMenuEntry[0].style.setProperty('color',hexColor,'important');$currentMenuEntry[0].style.setProperty('color',hexColor,'important')});var primaryFontSpectrum=this.getSpectrum('#DesignFont-color',primaryFontColor,function(tinycolor){var hexColor=tinycolor.toHexString();primaryFontColor=hexColor;$('body').css('color',hexColor)});var primaryFontHeaderSpectrum=this.getSpectrum('#DesignFont-color-header',primaryFontColorHeader,function(tinycolor){var hexColor=tinycolor.toHexString();primaryFontColorHeader=hexColor;$('.jarviswidget>header>h2').css('color',hexColor);$('.jarviswidget .widget-icon').css('color',hexColor)});var bodySpectrum=this.getSpectrum('#DesignBody-background',bodyBackgroundColor,function(tinycolor){var hexColor=tinycolor.toHexString();bodyBackgroundColor=hexColor;$('body').css('background',hexColor)});var bodyPageHeadlineSpectrum=this.getSpectrum('#DesignBody-page-headline',bodyPageHeadlineColor,function(tinycolor){var hexColor=tinycolor.toHexString();bodyPageHeadlineColor=hexColor;$('h1, h2, h3, h4, h5, h6').css('color',hexColor);var element=document.getElementsByClassName('page-title')[0];element.style.setProperty('color',hexColor,'important');$(element).find('span').css('color',hexColor)});var windowHeaderSpectrum=this.getSpectrum('#DesignWindow-background-color',windowHeaderBackground,function(tinycolor){var hexColor=tinycolor.toHexString();windowHeaderBackground=hexColor;$('.jarviswidget>header').css('background',hexColor)});var windowBorderSpectrum=this.getSpectrum('#DesignWindow-border-color',windowBorderColor,function(tinycolor){var hexColor=tinycolor.toHexString();windowBorderColor=hexColor;$('.jarviswidget>header').css('border-color',hexColor);var element=$('.jarviswidget>div')[0];element.style.setProperty('border-right-color',hexColor,'important');element.style.setProperty('border-left-color',hexColor,'important');element.style.setProperty('border-bottom-color',hexColor,'important')});var windowBodySpectrum=this.getSpectrum('#DesignWindow-body-color',windowBodyColor,function(tinycolor){var hexColor=tinycolor.toHexString();windowBodyColor=hexColor;var element=$('.jarviswidget>div')[0];element.style.setProperty('background-color',hexColor,'important')});var tableOddColorSpectrum=this.getSpectrum('#DesignTable-odd-color',tableOddColor,function(tinycolor){var hexColor=tinycolor.toHexString();tableOddColor=hexColor;return!0});var tableOddColorHoverSpectrum=this.getSpectrum('#DesignTable-hover-color',tableHoverColor,function(tinycolor){var hexColor=tinycolor.toHexString();tableHoverColor=hexColor;return!0});$('#DesignWell-color').change(function(){if($(this).val()==1){$('.well').css({'background-color':'#232323','border':'1px solid #333','box-shadow':'0 1px 1px #2d2d2d'})}else{$('.well').css({'background-color':'#fbfbfb','border':'1px solid #ddd','box-shadow':'0 1px 1px #ececec'})}});var tableOddColorHoverSpectrum=this.getSpectrum('#DesignMain-header-background',mainHeaderBackgroundColor,function(tinycolor){var hexColor=tinycolor.toHexString();mainHeaderBackgroundColor=hexColor;$('body>header').css('background',hexColor);$('.btn-header>:first-child>a').css('background',hexColor);return!0});var tableOddColorHoverSpectrum=this.getSpectrum('#DesignMain-header-text-color',mainHeaderTextColor,function(tinycolor){var hexColor=tinycolor.toHexString();mainHeaderTextColor=hexColor;$('body>header').css('color',hexColor);$('.btn-header>:first-child>a').css('color',hexColor);$('.btn-header>:first-child>a').css('border-color',hexColor);return!0})},getSpectrum:function(selector,color,callback){var colorValue=$(selector).val();if(colorValue){color=colorValue}
return $(selector).spectrum({color:color,showInput:!0,allowEmpty:!1,showAlpha:!1,preferredFormat:'hex',chooseText:'Ok',cancelText:'Cancel',move:callback,change:callback})},handleSilder:function(ev){if(ev.value==null){ev.value=0}
navigationColorFade=parseInt(ev.value,10);asideStyle.background='linear-gradient(to right, '+prim+'  93%, '+secondaryColor+'  100%)'}});App.Controllers.NmapIndexController=Frontend.AppController.extend({$ajaxLoader:null,discoveryId:null,intervalID:null,filename:null,servicetemplates:null,_initialize:function(){var self=this;this.$ajaxLoader=$('#loader');$('#executeNmapDiscovery').click(function(){self.discoveryId=$('#NmapDiscoveryResultNmapDiscoveryId').val();self.executeNmapDiscovery(self.discoveryId)});$('form').submit(function(e){e.preventDefault();$('.discoveryResultFormField').each(function(i,el){$el=$(el);if($el.hasClass('servicetemplateChosen')){$el.prop('disabled',!0)}
if($el.hasClass('SevicetemplateValue')){if($el.val()==null||$el.val()==''){$el.parents('tr').find(':input').prop('disabled',!0)}}
if($el.hasClass('hostname')){if($el.val()==null||$el.val()==''){$el.prop('disabled',!0)}}});$('form')[0].submit()})},executeNmapDiscovery:function(discoveryId){var self=this;$('#flash-NmapDiscoveryMsg').removeClass().empty();this.$ajaxLoader.html('<center><i class="fa fa-cog fa-4x fa-spin"></i><br /><span>'+this.getVar('executing_nmap_discovery')+'</span></center>');this.getDiscoveryResult(function(response){var data=$.parseJSON(response.responseText);self.intervalID=setInterval(self.checkForFinishedNmapDiscovery,2000,data,discoveryId,self)})},getDiscoveryResult:function(callback){$.ajax({url:"/discovery_module/nmap/discovery/"+encodeURIComponent(this.discoveryId),type:"POST",cache:!1,error:function(){},success:function(){},complete:callback})},checkForFinishedNmapDiscovery:function(filename,discoveryId,self){$.ajax({url:"/discovery_module/nmap/broadcast/"+encodeURIComponent(filename)+'/'+discoveryId,type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){try{var data=$.parseJSON(response.responseText);if(data.hasOwnProperty('finished')&&data.finished==!0){clearInterval(self.intervalID);self.getRenderedFormFields(filename,discoveryId,self)}
if(data.hasOwnProperty('stop')){clearInterval(self.intervalID)}}catch(e){clearInterval(self.intervalID)}},})},getRenderedFormFields:function(filename,discoveryId,self){$.ajax({url:"/discovery_module/nmap/discoveryresult/"+encodeURIComponent(filename)+'/'+discoveryId,type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){$('#loader').html(response.responseText);$('#discoveryResultFormActions').show();$('.chosen').chosen();$('.changeDefault').change(function(){var identifier=$(this).val();var $id=$('.'+identifier);var previousSelectedId=$('.selected_'+identifier).val();if($(this).prop('checked')){if(self.servicetemplates==null){$.ajax({url:"/discovery_module/nmap/getServicetemplates/",type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){self.servicetemplates=$.parseJSON(response.responseText);self.buildNewChosenOptions(self.servicetemplates,identifier,previousSelectedId)},})}else{self.buildNewChosenOptions(self.servicetemplates,identifier,previousSelectedId)}}else{$id.val(previousSelectedId);$id.prop('disabled',!0);$id.trigger("chosen:updated")}});$('.existingBlocker').each(function(){if($(this).val()==1){$(this).parent().find('td').css({'pointer-events':'none','filter':'grayscale(0.5) blur(2px)',})}})},})},buildNewChosenOptions:function(servicetemplates,id,previousSelectedId){var $id=$('.'+id);var html='';for(var i in servicetemplates){html+='<option value="'+i+'">'+servicetemplates[i]+'</option>'}
$id.html(html);$id.val(previousSelectedId);$id.prop('disabled',!1);$id.trigger("chosen:updated");$id.change(function(){var val=$(this).val();$('.SevicetemplateValue_'+id).val(val)})}});App.Controllers.NmapConfigurationsEditController=Frontend.AppController.extend({address:null,bitmask:null,subnetmask:null,components:['Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var self=this;$('#add_new_mapping').click(function(){self.addMapping()});$('#NmapConfigurationSingleHostScan').change(function(){if($(this).is(':checked')==!0){$('#NmapConfigurationBitmask').prop('disabled',!0)}else{$('#NmapConfigurationBitmask').prop('disabled',!1)}});$(document).on('click','.deleteMapping',function(){$(this).parents('.deleteMappingContainer').remove()})},addMapping:function(){this.Ajaxloader.show();$.ajax({url:"/discovery_module/nmap_configurations/addMapping/",type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){$('#mappingContainer').append(response.responseText);this.Ajaxloader.hide();$('.servicetemplateMapping').chosen({search_contains:!0,enable_split_word_search:!0})}.bind(this)})},});App.Controllers.NmapConfigurationsAddController=Frontend.AppController.extend({address:null,bitmask:null,subnetmask:null,components:['Ajaxloader'],_initialize:function(){this.Ajaxloader.setup();var self=this;$('#NmapConfigurationAddress').keyup(function(){var value=$(this).val();if(value!=null){self.address=value;self.printRange()}});$('#NmapConfigurationBitmask').keyup(function(){var value=$(this).val();if(value!=null){self.bitmask=value;self.subnetmask=self.getDecSubnetmask();self.printRange()}});$('#add_new_mapping').click(function(){self.addMapping()});$('#NmapConfigurationSingleHostScan').change(function(){if($(this).is(':checked')==!0){$('#NmapConfigurationBitmask').prop('disabled',!0)}else{$('#NmapConfigurationBitmask').prop('disabled',!1)}});$(document).on('click','.deleteMapping',function(){console.log('delete fired');$(this).parents('.deleteMappingContainer').remove()})},addMapping:function(){this.Ajaxloader.show();$.ajax({url:"/discovery_module/nmap_configurations/addMapping/",type:"POST",cache:!1,error:function(){},success:function(){},complete:function(response){$('#mappingContainer').append(response.responseText);this.Ajaxloader.hide();$('.servicetemplateMapping').chosen({search_contains:!0,enable_split_word_search:!0})}.bind(this)})},printRange:function(){if(this.address==null||this.bitmask==null){return}
if(this.isValidIPv4(this.address)){this.calculateRange(this.address,this.bitmask)}},calculateRange:function(address,bitmask){var range={'from':'','to':''}
var address=address.split('.');console.log(address);console.log(bitmask);var hostbits=(32-bitmask);var addressBitmask=[];for(var i=0;i<address.length;i++){addressBitmask[i]=this.dec2bin(address[i])}
var c=hostbits;var t=hostbits;for(var i=addressBitmask.length-1;i>=0;i--){for(var j=addressBitmask[i].length-1;j>=0;j--){if(c==(t-8)){c=(c-8);t=(t-8);console.log(c);console.log(t)}
addressBitmask[i][j]=0;c--}}
console.log(addressBitmask)},getDecSubnetmask:function(){var bitmask=this.bitmask;var subnetbitmask='';k=1;for(var i=0;i<32;i++){if(i<(bitmask)){subnetbitmask+=1}else{subnetbitmask+=0}
if(i>0&&i<24&&(k%8==0)){subnetbitmask+='.';k=0}
k++}
subnetbitmask=subnetbitmask.split('.');var subnetmask=[];for(var i=0;i<subnetbitmask.length;i++){subnetmask[i]=this.bin2dec(subnetbitmask[i])}
return subnetmask},isValidIPv4:function(ip){if(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(ip)){return!0}
return!1},dec2bin:function(dec){var n=(dec>>>0).toString(2);return"00000000".substr(n.length)+n},bin2dec:function(bin){return parseInt(bin,2)}});App.Controllers.SatellitesUsedByController=Frontend.AppController.extend({components:['Masschange'],_initialize:function(){this.Masschange.setup({'controller':'hosts','checkboxattr':'hostname'})}});App.Controllers.EventcorrelationsEditCorrelationController=Frontend.AppController.extend({components:['Ajaxloader'],$serviceList:null,_initialize:function(){var self=this,idToCheck=null,$clickObject={};this.$serviceList=this.getVar('servicesList');this.EvcHostName=this.getVar('hostName');this.EvcHostId=this.getVar('hostId');this.evcTree=this.getVar('evcTree');this.highlightedHostId=this.getVar('highlightedHostId');this.$cloneEvcDrawPad=$('#evkDrawPad').clone();this.options={'container':'#evkDrawPad','mainDivClass':'evkWidgetBody'}
var ChosenAjaxObj=new ChosenAjax({id:'ModalServices'});if(!$.isEmptyObject(this.evcTree)){self.drawEvcTree(this.evcTree)}else{this.evcTree=[];$.ajax({dataType:"json",url:'/eventcorrelation_module/eventcorrelations/loadServicesByString.json',data:{'angular':!0,'notServiceId':self.EvcHostId,'filter[Host.name]':'','filter[Service.servicename]':''},success:function(response){ChosenAjaxObj.addOptionGroups(response.services)}})}
ChosenAjaxObj.setCallback(function(searchString){var selected=ChosenAjaxObj.getSelected();$.ajax({dataType:"json",url:'/eventcorrelation_module/eventcorrelations/loadServicesByString.json',data:{'angular':!0,'notServiceId':self.EvcHostId,'filter[Host.name]':searchString,'filter[Service.servicename]':searchString,'selected[]':selected},success:function(response){ChosenAjaxObj.addOptionGroups(response.services);ChosenAjaxObj.setSelected(selected)}})});ChosenAjaxObj.render();this.ChosenAjaxObj=ChosenAjaxObj;$(document).click(function(){var $classResult=$('#evkDrawPad').find('.bounce_new');if($classResult.length>0){$classResult.each(function(){$(this).removeClass('animated_new infinite_new bounce_new').addClass('evcBorder')})}
this.highlightedHostId=null});$(document).on('click','.addLayerBtn, .fa-pencil',function(event){$clickObject=$(event.target);var layerNumber=0,editMode=$clickObject.attr('mode'),serviceLayerId=$clickObject.closest('div.layerContainer').attr('id'),prevId=serviceLayerId.replace(/[0-9]+(?!.*[0-9])/,function(match){layerNumber=parseInt(match,10)-1;return layerNumber});self.resetErrorMessages();self.switchSelectServiceListForCurrentLayer((editMode==='new')?serviceLayerId:prevId);if(editMode==='edit'){self.updateModalForEdit($clickObject,serviceLayerId,prevId)}
$modalObject=$('#defaultModal');$modalObject.modal().on('hidden.bs.modal',function(){self.resetInputFields($(this))});$('#defaultModal .action_button').off('click').on('click',function(){if(self.validateFields()){$modalObject.modal('hide');switch(editMode){case 'new':self.drawEventCorrelationBranch(serviceLayerId,$clickObject);break;case 'edit':var evcNodeId=$('#'+($clickObject.closest('div').attr('id').replace('EditDiv',''))).attr('nodeId');var newEvcSettings={'vServiceName':$('#ModalName').val(),'operator':$('#ModalOperator').val()+$('#ModalOperatorModifier').val(),'vServiceTemplateId':$('#ModalServicetemplates').val()};var currentEvcBranch=self.evcTree[(layerNumber-1)][evcNodeId],oldConfigServiceIds=[],newConfigServiceIds=[];if(self.isFirstLayer(prevId)){$.each(currentEvcBranch,function(index,element){oldConfigServiceIds.push(element.Service.id)});$.each(self.getSelectedServices($('#ModalServices').val()),function(index,element){newConfigServiceIds.push(element[0].serviceId)});var updateResult=self.updateFirstLevelEventCorrelationBranch(layerNumber,evcNodeId,newEvcSettings,_.difference(oldConfigServiceIds,newConfigServiceIds),_.difference(newConfigServiceIds,oldConfigServiceIds));if(updateResult){$('#evkDrawPad').html(self.$cloneEvcDrawPad.html());self.drawEvcTree(self.evcTree)}}else{$.each(currentEvcBranch,function(index,element){oldConfigServiceIds.push(element.Eventcorrelation.id)});$.each($('#ModalVServices').val(),function(index,vServiceId){newConfigServiceIds.push(vServiceId.replace('_vService',''))});var updateResult=self.updateEventCorrelationBranch(layerNumber,evcNodeId,newEvcSettings,_.difference(oldConfigServiceIds,newConfigServiceIds),_.difference(newConfigServiceIds,oldConfigServiceIds));if(updateResult){$('#evkDrawPad').html(self.$cloneEvcDrawPad.html());self.drawEvcTree(self.evcTree)}}
break}
self.resetInputFields($modalObject);self.heightAdjustment()}})}.bind(this));$(document).on('click','.fa-trash-o',function(event){$clickObject=$(event.target);var evcNodeId=$('#'+($clickObject.closest('div').attr('id').replace('EditDiv',''))).attr('nodeId'),layerNumber=parseInt($clickObject.closest('div.layerContainer').attr('id').replace(/layer_/,''),10);self.deleteEvcNode((layerNumber-1),evcNodeId);self.checkForMissingParents();$('#evkDrawPad').html(self.$cloneEvcDrawPad.html());self.drawEvcTree(self.evcTree)});$('#ModalOperator').change(function(){if($(this).val()==='min'){$('#ModalOperatorModifier').prop({'disabled':!1,'required':!0}).keyup(function(){this.value=this.value.replace(/[^0-9]/g,'')})}else{$('#ModalOperatorModifier').prop({'disabled':!0,'required':!1}).val('');$('#ModalOperatorModifierError').addClass('hidden')}});$('#saveEvcButton').on('click',function(event){event.preventDefault();$('#saveEvcButton').prop('disabled',!0);if(!self.checkAllConnections()||!self.validateEndLayer()){event.preventDefault();event.stopPropagation();$('#saveEvcButton').prop('disabled',!1)}else{$('#EventcorrelationEditCorrelationForm').submit();return!0}})},getOperatorErrorMessage:function(serviceSelector){var operator=$('#ModalOperator').val();var serviceCount=_.size($('#'+serviceSelector).val());var operatorModifier=$('#ModalOperatorModifier').val();var msg,retVal;switch(operator){case 'and':if(serviceCount<2){msg='The AND Operator requires at least two Services';retVal=!0}else{retVal=!1}
break;case 'or':if(serviceCount<2){msg='The OR Operator requires at least two Services';retVal=!0}else{retVal=!1}
break;case 'eq':if(serviceCount!=1){msg='The EQUAL Operator can only have one Service';retVal=!0}else{retVal=!1}
break;case 'min':if(serviceCount<1){msg='The MIN Operator requires at least one Service';retVal=!0}else if(serviceCount>=1&&(operatorModifier==''||operatorModifier>serviceCount)){msg='';opModMsg='The MIN Operator requires a Modifier which is in the range of 1 - X (where X is the number of the selected services)';$('#ModalOperatorModifierError').text(opModMsg);retVal=!0}else{retVal=!1}
break}
if(retVal){if(msg!=null){$('#ModalOperatorError').text(msg)}
return!0}
return!1},deleteEvcNode:function(evcLayer,evcServiceId){var currentParentId=null;find_parent_loop:for(var parentEvcId in this.evcTree[evcLayer]){for(var k in this.evcTree[evcLayer][parentEvcId]){if(this.evcTree[evcLayer][parentEvcId][k].Eventcorrelation.id==evcServiceId){currentParentId=this.evcTree[evcLayer][parentEvcId][k].Eventcorrelation.parent_id;$('input[value="'+evcServiceId+'"]').remove();$('input[name^="layer_'+evcLayer+'['+evcServiceId+']"]').remove();break find_parent_loop}}
if(currentParentId!==null){break}}
if(evcLayer===1){delete this.evcTree[0][evcServiceId]}
if(_.size(this.evcTree[evcLayer][parentEvcId])===1){delete this.evcTree[evcLayer][parentEvcId]}else{this.evcTree[evcLayer][parentEvcId].splice(k,1);return}
if(currentParentId!==null){this.deleteEvcNode(evcLayer+1,currentParentId)}},checkForMissingParents:function(){this.deleteEmptyEvcLayers();for(var evcLayer in this.evcTree){for(var parentEvcId in this.evcTree[evcLayer]){if(parentEvcId==''){continue}
var parentExists=!1;var evcLayerToCheck=parseInt(evcLayer,10)+1;if(typeof this.evcTree[evcLayerToCheck]!='undefined'){for(var parentEvcIdToCheck in this.evcTree[evcLayerToCheck]){for(var k in this.evcTree[evcLayerToCheck][parentEvcIdToCheck]){if(String(this.evcTree[evcLayerToCheck][parentEvcIdToCheck][k].Eventcorrelation.id)===String(parentEvcId)){parentExists=!0;break}}
if(parentExists===!0){break}}}
if(parentExists===!1){var container=this.evcTree[evcLayer][parentEvcId];delete this.evcTree[evcLayer][parentEvcId];for(var evcService in container){container[evcService].Eventcorrelation.parent_id=null;var key=container[evcService].Eventcorrelation.id+'_vService';this.evcTree[evcLayer][key]=[];this.evcTree[evcLayer][key].push(container[evcService])}}}}},deleteEmptyEvcLayers:function(){var tmpEvcTree=[];for(var evcLayer in this.evcTree){if(_.isEmpty(this.evcTree[evcLayer])===!1){tmpEvcTree.push(this.evcTree[evcLayer])}}
this.evcTree=tmpEvcTree},validateFields:function(){var self=this;var isValid=!0;var serviceSelector='';$('input[required],select[required]').each(function(i,requiredField){var selector=$(requiredField).attr('id');if(selector=='ModalVServices'||selector=='ModalServices'){serviceSelector=selector}
if($(requiredField).val()==''||$(requiredField).val()===null||$(requiredField).val()==0){$('#'+$(requiredField).attr('id')+'Error').removeClass('hidden');isValid=!1}else if(self.getOperatorErrorMessage(serviceSelector)&&($(requiredField).attr('id')=='ModalOperator'||$(requiredField).attr('id')=='ModalOperatorModifier')){$('#'+$(requiredField).attr('id')+'Error').removeClass('hidden');isValid=!1}else{$('#'+$(requiredField).attr('id')+'Error').addClass('hidden')}});return isValid},getSelectedServices:function(ids){var serviceObjects=[];for(var id in ids){var currentId=ids[id];if(!this.$serviceList.hasOwnProperty(currentId)){$.ajax({dataType:"json",url:'/eventcorrelation_module/eventcorrelations/getServiceWithStateById/'+currentId+'.json',async:!1,data:{'angular':!0},success:function(response){this.$serviceList[currentId]=response.service[currentId]}.bind(this)})}
for(var service in this.$serviceList){if(service==currentId){serviceObjects.push([this.$serviceList[service]])}}}
return serviceObjects},prepareSelectedServicesForEvcTreeUpdate:function(serviceObject,parentId,evcNodeId,hostId,operator){return{'Eventcorrelation':{'id':evcNodeId.replace('_vService',''),'parent_id':parentId,'host_id':hostId,'service_id':serviceObject.serviceId,'operator':operator},'Service':{'Host':{'name':serviceObject.hostName},'Servicetemplate':{'name':serviceObject.Servicetemplate.name,'servicetemplate_id':serviceObject.Servicetemplate.id,},'host_id':serviceObject.hostId,'id':serviceObject.serviceId,'name':serviceObject.serviceName,'service_type':serviceObject.serviceType,'servicetemplate_id':serviceObject.Servicetemplate.id,'uuid':serviceObject.serviceUuid}}},updateModalForEdit:function($clickObject,serviceLayerId,prevId){var self=this,selectedServices=[],buttonParentDivId=$clickObject.closest('div').attr('id'),operatorId=buttonParentDivId.replace('vServiceEditDiv','nodeOperator'),operatorDetails=$('input[name^="'+prevId+'['+operatorId.replace('_nodeOperator','')+'"]').not('input[name^="'+prevId+'['+operatorId.replace('_nodeOperator','')+'][children]"]'),operatorValue=$(operatorDetails[0]).val();$('#ModalName').val($(operatorDetails[1]).val());$('#ModalServicetemplates').val($(operatorDetails[2]).val()).trigger('chosen:updated');if(operatorValue.match(/^min*/)){$('#ModalOperator').val('min').trigger('chosen:updated');$('#ModalOperatorModifier').prop('disabled',!1).val(operatorValue.replace(/[^0-9]+/g,''))}else{$('#ModalOperatorModifier').prop({'required':!1,'disabled':!0});$('#ModalOperator').val(operatorValue).trigger('chosen:updated')}
if(self.isFirstLayer(prevId)){$.each($('#'+operatorId.replace('_nodeOperator',' :input')),function(index,selectedElement){var currentService=self.$serviceList[$(selectedElement).val()];if(typeof currentService!='undefined'){selectedServices.push(currentService.serviceId)}});$.ajax({dataType:"json",url:'/eventcorrelation_module/eventcorrelations/loadServicesByString.json',data:{'angular':!0,'notServiceId':self.EvcHostId,'selected[]':selectedServices},success:function(response){$('#ModalServices').val(selectedServices).trigger('chosen:updated');self.ChosenAjaxObj.addOptionGroups(response.services);self.ChosenAjaxObj.setSelected(selectedServices)}})}else{$.each($('input[name^="'+prevId+'['+operatorId.replace('_nodeOperator','')+'][children]"]'),function(index,element){$('#ModalVServices option[value='+$(element).val()+'_vService]').removeAttr('disabled');selectedServices.push($(element).val()+'_vService')})
$('#ModalVServices').val(selectedServices).trigger('chosen:updated')}},drawEventCorrelationPhysicalLayer:function(parentContainer,serviceObjects,evcId){var self=this,colors=['#449D44','#DF8F1D','#C9302C','#92A2A8'],notMonitoredBackgroundColor='#337ab7',$newDiv=$('<div/>',{'id':(evcId!==null)?evcId:_.uniqueId('ui-id-')}),newDivId=$newDiv.attr('id'),serviceObjectCounter=1,divsToConnect=[],parentId=parentContainer.attr('id'),evcTreeLayer=0,serviceDataToAdd={};serviceDataToAdd[newDivId]=[];parentContainer.append($newDiv);$.each(serviceObjects,function(index,object){object=object[0];var highlightClass='';var disabledClass='';var disabledMessage='';if(object.disabled==='1'){disabledClass=' serviceDisabled disabledIcon';disabledMessage=' (!!!DISABLED!!!)'}
if(self.highlightedHostId==object.hostId){highlightClass=' animated_new infinite_new bounce_new'}
$newDiv.append($('<div/>',{'class':'service firstLayerService'+highlightClass+disabledClass,'id':newDivId+'_'+serviceObjectCounter}).append($('<div/>',{'class':'serviceStateColor pull-left'}).css('background-color',(object.currentState!==null)?colors[object.currentState]:notMonitoredBackgroundColor)).append($('<div/>',{'class':'serviceInformation'}).append($('<div/>',{'class':'hosttext ellipsis','title':htmlspecialchars(object.hostName)}).append('<i class="fa fa-desktop"></i> '+htmlspecialchars(object.hostName))).append($('<div/>',{'class':'servicetext ellipsis','title':htmlspecialchars(object.serviceName+disabledMessage)}).append('<i class="fa fa-'+((object.serviceType==2)?'sitemap fa-fw fa-rotate-90':'gear')+'"></i> '+htmlspecialchars(object.serviceName)))).append($('<input/>',{'type':'hidden','value':object.serviceId,'name':parentId+'['+newDivId+'][children]['+serviceObjectCounter+']'})));divsToConnect.push(newDivId+'_'+serviceObjectCounter);if(evcId===null){serviceDataToAdd[newDivId].push(self.prepareSelectedServicesForEvcTreeUpdate(object,newDivId,newDivId+'_'+serviceObjectCounter,null,null))}
serviceObjectCounter++});if(self.evcTree[evcTreeLayer]===undefined&&evcId===null){self.evcTree[evcTreeLayer]=serviceDataToAdd}else{if(evcId===null){$.extend(!0,self.evcTree[evcTreeLayer],serviceDataToAdd)}}
$operatorPosition={'positionTop':parseInt(($newDiv.position().top-3),10),'height':$newDiv.height(),'id':newDivId,'divsToConnect':divsToConnect};return $operatorPosition},updateFirstLevelEventCorrelationBranch:function(layerNumber,evcNodeId,newEvcSettings,serviceIdsToDelete,serviceIdsAdd){var self=this,updateEvc=!1,childsLayer=layerNumber-1;self.updateOperatorDetails(layerNumber,evcNodeId,newEvcSettings);self.updateEvcName(layerNumber,evcNodeId,newEvcSettings.vServiceName);self.updateEvcNodeInEvcTree(layerNumber,evcNodeId,newEvcSettings);if(serviceIdsToDelete.length===0&&serviceIdsAdd.length===0){return updateEvc}
if(serviceIdsToDelete.length>0){self.deleteServicesFromEvcBranch(childsLayer,evcNodeId,serviceIdsToDelete);updateEvc=!0}
if(serviceIdsAdd.length>0){self.addServicesToEvcBranch(childsLayer,evcNodeId,serviceIdsAdd);updateEvc=!0}
return updateEvc},updateEventCorrelationBranch:function(layerNumber,evcNodeId,newEvcSettings,serviceIdsToDelete,serviceIdsAdd){var self=this,updateEvc=!1,childsLayer=layerNumber-1;self.updateOperatorDetails(layerNumber,evcNodeId,newEvcSettings);self.updateEvcName(layerNumber,evcNodeId,newEvcSettings.vServiceName);if(serviceIdsToDelete.length===0&&serviceIdsAdd.length===0){return updateEvc}
if(serviceIdsToDelete.length>0){self.deleteVirtualServicesFromEvcBranch(childsLayer,serviceIdsToDelete);updateEvc=!0}
if(serviceIdsAdd.length>0){self.addVirtualServicesToEvcBranch(childsLayer,evcNodeId,serviceIdsAdd);updateEvc=!0}
return updateEvc},addVirtualServicesToEvcBranch:function(layerNumber,evcNodeId,serviceIdsAdd){var self=this,indexToDelete=[],newServices={},sizeOfChilds=_.size(self.evcTree[layerNumber][evcNodeId]);$.each(this.evcTree[layerNumber],function(indexEvc,evcElementsArray){$.each(evcElementsArray,function(index,element){if(~$.inArray(element.Eventcorrelation.id,serviceIdsAdd)){self.evcTree[layerNumber][indexEvc][index].Eventcorrelation.parent_id=evcNodeId;newServices[sizeOfChilds++]=self.evcTree[layerNumber][indexEvc][index];indexToDelete.push(indexEvc)}})});$.extend(!0,self.evcTree[layerNumber][evcNodeId],newServices);self.evcTree[layerNumber]=_.omit(self.evcTree[layerNumber],indexToDelete)},deleteVirtualServicesFromEvcBranch:function(layerNumber,serviceIdsToDelete){var self=this;$.each(this.evcTree[layerNumber],function(indexEvc,evcElementsArray){var indexToDelete=[],tmpObjects=[];$.each(evcElementsArray,function(index,element){if(~$.inArray(element.Eventcorrelation.id,serviceIdsToDelete)){self.evcTree[layerNumber][indexEvc][index].Eventcorrelation.parent_id=null;self.evcTree[layerNumber][element.Eventcorrelation.id+'_vService']=[self.evcTree[layerNumber][indexEvc][index]];$('input[value="'+element.Eventcorrelation.id+'"]').remove();indexToDelete.push(index)}else{tmpObjects.push(self.evcTree[layerNumber][indexEvc][index])}});if(indexToDelete.length>0){if(_.size(tmpObjects)===0){delete self.evcTree[layerNumber][indexEvc];return!1}
self.evcTree[layerNumber][indexEvc]=tmpObjects;return!1}})},updateOperatorDetails:function(layerNumber,evcNodeId,operatorDetails){$('#'+evcNodeId+'_nodeOperator').text(operatorDetails.operator);$('input[name="layer_'+layerNumber+'['+evcNodeId+'][operator]"]').val(operatorDetails.operator);$('input[name="layer_'+layerNumber+'['+evcNodeId+'][vServiceName]"]').val(operatorDetails.vServiceName);$('input[name="layer_'+layerNumber+'['+evcNodeId+'][vServiceTemplateId]"]').val(operatorDetails.vServiceTemplateId)},updateEvcName:function(layerNumber,evcNodeId,evcName){$('#'+evcNodeId+'_vService').children('.serviceInformation').children('.servicetext').prop('title',evcName).contents().last().replaceWith(' '+evcName);$('#'+evcNodeId+'_vService').children(':input[name="layer_'+(layerNumber+1)+'['+evcNodeId+']['+evcNodeId+'_nodeOperator]"]').val(evcName)},updateEvcNodeInEvcTree:function(layerNumber,evcNodeId,evcSettings){var self=this;$.each(this.evcTree[layerNumber],function(indexEvc,evcElementsArray){var exit=!1;$.each(evcElementsArray,function(index,element){if(element.Eventcorrelation.id===evcNodeId){self.evcTree[layerNumber][indexEvc][index].Eventcorrelation.operator=evcSettings.operator;self.evcTree[layerNumber][indexEvc][index].Service.name=evcSettings.vServiceName;self.evcTree[layerNumber][indexEvc][index].Service.servicetemplate_id=evcSettings.vServiceTemplateId;exit=!0;return!1}});if(exit){return!1}})},addServicesToEvcBranch:function(layerNumber,evcNodeId,serviceIdsAdd){var self=this,newServices={},sizeOfChilds=_.size(self.evcTree[layerNumber][evcNodeId]);$.each(_.pick(self.$serviceList,serviceIdsAdd),function(serviceId,serviceObject){newServices[sizeOfChilds++]=self.prepareSelectedServicesForEvcTreeUpdate(serviceObject,evcNodeId,evcNodeId+'_'+sizeOfChilds,null,null)});$.extend(!0,self.evcTree[layerNumber][evcNodeId],newServices)},deleteServicesFromEvcBranch:function(layerNumber,evcNodeId,serviceIdsToDelete){var self=this,tmpObjects=[];$.each(self.evcTree[layerNumber][evcNodeId],function(index,element){if(!~$.inArray(element.Service.id,serviceIdsToDelete)){tmpObjects.push(self.evcTree[layerNumber][evcNodeId][index])}});self.evcTree[layerNumber][evcNodeId]=tmpObjects},drawEventCorrelationBranch:function(serviceLayerId,$clickObject){var self=this,divsToConnect=[],$virtualServiceObject={'hostName':self.EvcHostName,'serviceType':'2','currentState':null,'serviceName':'','usedBy':''};idToCheck=serviceLayerId.replace(/[0-9]+(?!.*[0-9])/,function(match){return parseInt(match,10)+1});$servicesLayerElement=$clickObject.closest('div');$operatorLayerDivElement=$servicesLayerElement.next();if(self.isFirstLayer(serviceLayerId)){$eventCorrelationDivPosition=self.drawEventCorrelationPhysicalLayer($clickObject.closest('div'),self.getSelectedServices($('#ModalServices').val()),null)}else{divsToConnect=($('#ModalVServices').val())?$('#ModalVServices').val():[];$eventCorrelationDivPosition={'id':null,'positionTop':self.getOptimalTopPositionForOperator($operatorLayerDivElement,divsToConnect),'height':0,'divsToConnect':divsToConnect}}
$eventCorrelationOperatorDivDetails=self.drawOperator(serviceLayerId,$eventCorrelationDivPosition,$('#ModalOperator').val()+$('#ModalOperatorModifier').val(),self.removeIllegalCharacters($('#ModalName').val()),$('#ModalServicetemplates').val(),!1);self.addVServicesHiddenFields(serviceLayerId,divsToConnect,$eventCorrelationOperatorDivDetails);if(!self.layerAlreadyExists(idToCheck)){self.addNewServiceLayer(idToCheck)}
$virtualServiceObject.serviceName=self.removeIllegalCharacters($('#ModalName').val());self.drawVirtualService($('#'+idToCheck),$eventCorrelationOperatorDivDetails,$virtualServiceObject,divsToConnect)},heightAdjustment:function(){$('.globalLayerContainer').not('#layer_1').css('height',parseInt($('#layer_1').outerHeight(),10)+'px')},resetInputFields:function($modalObject){$modalObject.find("input,select").val('').trigger('chosen:updated').end();$('input[required],select[required]').each(function(i,requiredField){$('#'+$(requiredField).attr('id')+'Error').addClass('hidden')});$('#ModalServices').trigger('chosen:updated')},drawOperator:function(serviceLayerId,operatorDetails,operatorValue,vServiceName,vServiceTemplateId,reDraw){var self=this,connection=null,operatorHeight=38,$operatorDetails={},parentContainer=$('#'+serviceLayerId).next(),virtualServiceObject={},currentLayerNumber=serviceLayerId.replace(/layer_/,'');operatorDetails.id=(operatorDetails.id===null)?_.uniqueId('ui-id-'):operatorDetails.id;$.when(parentContainer.append($('<div/>',{'class':'operator txt-color-white','id':operatorDetails.id+'_nodeOperator'}).css({'position':'absolute','top':parseInt((operatorDetails.positionTop+operatorDetails.height/2-operatorHeight/2),10)+'px'}).text(operatorValue)).append($('<input/>',{'type':'hidden','value':operatorValue,'name':serviceLayerId+'['+operatorDetails.id+'][operator]'})).append($('<input/>',{'type':'hidden','value':vServiceName,'name':serviceLayerId+'['+operatorDetails.id+'][vServiceName]'})).append($('<input/>',{'type':'hidden','value':vServiceTemplateId,'name':serviceLayerId+'['+operatorDetails.id+'][vServiceTemplateId]'}))).done(function(){var positionOptions=$('#'+operatorDetails.id+'_nodeOperator').position();$operatorDetails={'top':parseInt(positionOptions.top,10),'left':parseInt(positionOptions.left,10),'id':operatorDetails.id+'_nodeOperator','firstLayerServicesDivId':operatorDetails.id};$.each(operatorDetails.divsToConnect,function(index,divId){connection=new $.connect('#'+divId,'#'+operatorDetails.id+'_nodeOperator',self.options)})}).done(function(){if(!reDraw&&self.isNewService(operatorDetails.id)){virtualServiceObject[operatorDetails.id+'_vService']=[];virtualServiceObject[operatorDetails.id+'_vService'].push(self.prepareSelectedServicesForEvcTreeUpdate({'serviceId':operatorDetails.id+'_vService','hostName':self.EvcHostName,'Servicetemplate':{'name':null,'id':vServiceTemplateId},'hostId':self.EvcHostId,'id':operatorDetails.id,'serviceName':vServiceName,'servicetemplate_id':5,'serviceUuid':null,'serviceType':2},null,operatorDetails.id+'_vService',null,operatorValue));if(self.evcTree[currentLayerNumber]===undefined){self.evcTree[currentLayerNumber]={}}
$.when($.extend(!0,self.evcTree[currentLayerNumber],virtualServiceObject)).done(function(){self.setParentForNodeChilds(currentLayerNumber-1,operatorDetails.id,operatorDetails.divsToConnect)})}});return $operatorDetails},setParentForNodeChilds:function(layerNumber,parentId,nodeChilds){if(layerNumber===0){return!0}
var self=this;$.map(self.evcTree[layerNumber],function(element,index){if(~$.inArray(element[0].Eventcorrelation.id+'_vService',nodeChilds)){self.evcTree[layerNumber][index][0].Eventcorrelation.parent_id=parentId;if(self.evcTree[layerNumber][parentId]===undefined){self.evcTree[layerNumber][parentId]=[]}
self.evcTree[layerNumber][parentId].push(self.evcTree[layerNumber][index][0]);delete self.evcTree[layerNumber][index]}})},addNewServiceLayer:function(newLayerId){var $addVServiceButton=$('#layer_1').find('.addLayerBtn:first-child').clone(!0)
$('#evkDrawPad').append($('<div/>',{'class':'layerContainer globalLayerContainer ','id':newLayerId}).append($addVServiceButton),$('<div/>',{'class':'nodeLayerContainer globalLayerContainer',}))},layerAlreadyExists:function(idToCheck){if($('#'+idToCheck).length){return!0}
return!1},drawVirtualService:function(parentContainer,operatorDetails,virtualServiceObject,serviceListForHiddenFields){var self=this,colors=['#449D44','#DF8F1D','#C9302C','#92A2A8'],notMonitoredBackground='repeating-linear-gradient(-45deg, #57889C 5px, transparent 2px, #57889C 10px)',connection=null;parentContainer.append($('<div/>',{'class':'service','id':operatorDetails.firstLayerServicesDivId+'_vService','top_position':operatorDetails.top,'nodeId':operatorDetails.firstLayerServicesDivId}).append($('<div/>',{'class':'serviceStateColor pull-left'}).css('background',(virtualServiceObject.currentState===null)?notMonitoredBackground:colors[virtualServiceObject.currentState])).append($('<div/>',{'class':'serviceInformation'}).append($('<div/>',{'class':'hosttext ellipsis','title':virtualServiceObject.hostName}).append('<i class="fa fa-desktop"></i> '+virtualServiceObject.hostName)).append($('<div/>',{'class':'servicetext ellipsis','title':virtualServiceObject.serviceName}).append('<i class="fa fa-'+((virtualServiceObject.serviceType==1)?'gear':'sitemap fa-fw fa-rotate-90 txt-color-blue')+'"></i> '+virtualServiceObject.serviceName))).append($('<input/>',{'type':'hidden','disabled':!0,'value':virtualServiceObject.serviceName,'selectedValue':operatorDetails.firstLayerServicesDivId+'_vService','name':parentContainer.attr('id')+'['+operatorDetails.firstLayerServicesDivId+']['+operatorDetails.id+']'})).css({'position':'absolute','top':parseInt(operatorDetails.top,10)+'px'})).append(self.addEditDiv(operatorDetails,virtualServiceObject.usedBy,virtualServiceObject.hostName+'/ '+virtualServiceObject.serviceName));connection=new $.connect('#'+operatorDetails.id,'#'+operatorDetails.firstLayerServicesDivId+'_vService',self.options)},addEditDiv:function(operatorDetails,usedBy,title){return $('<div/>',{'id':operatorDetails.firstLayerServicesDivId+'_vServiceEditDiv','class':'editBox text-center'}).css({'top':operatorDetails.top}).append($('<a/>',{'class':'btn'}).append($('<i/>',{'class':'fa fa-pencil fa-lg','mode':'edit','title':title}))).append($('<a/>',{'class':'btn'}).append($('<i/>',{'class':'fa '+((usedBy.length===0)?'fa-trash-o':'fa-lock txt-color-orange helpText')+' fa-lg','title':usedBy})))},switchSelectServiceListForCurrentLayer:function(currentLayerId){var self=this;if(!self.isFirstLayer(currentLayerId)){$('#ModalServices').prop('required',!1).parent().parent().hide();var $optGroup=$('#ModalVServices').has('optgroup').length?$('#ModalVServices').children('optgroup'):$('<optgroup/>').attr({'label':self.EvcHostName});$optGroup.find('option').remove();$('#'+currentLayerId+' :input:hidden').each(function(index,element){if($('#ModalVServices option[value="'+$(element).attr('value')+'"]').length==0){$("<option/>").val($(element).attr('selectedValue')).text(self.EvcHostName+'/'+$(element).attr('value')).prop('disabled',($('.connector').children('p.left').hasClass($(element).attr('selectedvalue')))).appendTo($optGroup)}});$optGroup.appendTo('#ModalVServices');$('#ModalVServices').prop('required',!0).trigger('chosen:updated').parent().parent().show()}else{$('#ModalServices').prop('required',!0).parent().parent().show();$('#ModalVServices').prop('required',!1).parent().parent().hide()}},isFirstLayer:function(layerId){if(layerId==='layer_1'){return!0}
return!1},getOptimalTopPositionForOperator:function($operatorLayerDivElement,selectedServicesArray){var midPosition=midPositionWithoutHHOperator=elementTopPosition=0,operatorHeight=38;var operatorDivChildren=$operatorLayerDivElement.children('.operator');var convertedIds=selectedServicesArray.map(function(element){return'#'+element});var topPositionArray=$.map($(convertedIds.join()),function(element){return parseInt($(element).attr('top_position'),10)});var topPositionArrayFromOperatorDiv=[];var lowestPosition=Math.max.apply(null,topPositionArray);var highestPosition=Math.min.apply(null,topPositionArray);midPositionWithoutHHOperator=parseInt(highestPosition+((lowestPosition-highestPosition)/2),10);midPosition=parseInt(midPositionWithoutHHOperator+operatorHeight/2,10);if(operatorDivChildren.length===0){return midPosition}
$.each(operatorDivChildren,function(operatorIndex,operator){topPositionArrayFromOperatorDiv.push($(operator).position().top)});for(var i=0;i<100000;i++){var conflict=!1;$.each(topPositionArrayFromOperatorDiv,function(indexN,operatorTopPosition){if(midPosition+i>operatorTopPosition-operatorHeight/2-2&&midPosition+i<operatorTopPosition+operatorHeight+operatorHeight/2+2){conflict=!0;return}});if(!conflict){return midPosition+i}
var conflict=!1;$.each(topPositionArrayFromOperatorDiv,function(indexN,operatorTopPosition){if(midPosition-i>operatorTopPosition-operatorHeight/2-2&&midPosition-i<operatorTopPosition+operatorHeight+operatorHeight/2+2){conflict=!0;return}});if(!conflict){return midPosition-i}}
return midPosition},addVServicesHiddenFields:function(serviceLayerId,vServicesList,operatorDetails){$formElement=$('#EventcorrelationEditCorrelationForm');$.each(vServicesList,function(index,element){if($('input[value="'+element.replace('_vService','')+'"]')){$('input[value="'+element.replace('_vService','')+'"]').remove()}
$formElement.append($('<input/>',{'type':'hidden','value':element.replace('_vService',''),'name':serviceLayerId+'['+operatorDetails.firstLayerServicesDivId+'][children]['+index+']'}))})},validateEndLayer:function(){var self=this;$lastEvcLayerElement=$(self.options.container+' .layerContainer').last();if($lastEvcLayerElement.children('.service').length!==1){$('#errorMessage').show();$lastEvcLayerElement.addClass('alert-evc-warning');return!1}
return!0},checkAllConnections:function(){var connCheckSuccessfully=!0,currentId=null,allLayerObjects=$('[id^=layer_]').not('#layer_1'),allLayerObjectsCounter=allLayerObjects.length;$.each(allLayerObjects,function(index,element){$(element).removeClass('alert-info');if(allLayerObjectsCounter>(index+1)){$.each($(element).children('.service'),function(subindex,childElement){currentId=$(childElement).attr('id');if(!$('.connector').children('p.left').hasClass(currentId)){$(element).addClass('alert-info');$(childElement).addClass('alert-danger missing-connection-icon');connCheckSuccessfully=!1}else{$(childElement).removeClass('alert-danger missing-connection-icon')}})}});return connCheckSuccessfully},resetErrorMessages:function(){$('#errorMessage').hide();$('.alert-evc-warning').removeClass('alert-evc-warning')},drawEvcTree:function(evcTree){var self=this,selectedServicesGroupByParentId={},$eventCorrelationDivPosition={},operatorDetails={},divsToConnect={},currentEvcDivPosition=null;$.each(evcTree,function(layerIndex,eventCorrelationArray){if(!self.layerAlreadyExists('layer_'+(layerIndex+1))){self.addNewServiceLayer('layer_'+(layerIndex+1))}
$parentContainer=$('#layer_'+(layerIndex+1));$.each(eventCorrelationArray,function(parentId,serviceWithOperatorDetails){selectedServicesGroupByParentId[parentId]=[];$.each(serviceWithOperatorDetails,function(index,evcObject){var currentState=(self.$serviceList[evcObject.Service.id]!==undefined)?self.$serviceList[evcObject.Service.id].currentState:null;var usedBy='';selectedServicesGroupByParentId[parentId].push([{'serviceId':evcObject.Service.id,'hostName':evcObject.Service.Host.name,'hostId':evcObject.Service.host_id,'serviceType':evcObject.Service.service_type,'currentState':currentState,'serviceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name,'eventcorrelationId':evcObject.Eventcorrelation.id,'disabled':evcObject.Service.disabled,}]);if(evcObject.Eventcorrelation.operator!==null){usedBy=(evcObject.Eventcorrelation.usedBy!==undefined)?evcObject.Eventcorrelation.usedBy:'';operatorDetails[evcObject.Eventcorrelation.id]=[];operatorDetails[evcObject.Eventcorrelation.id].push({'Operator':{'layerIndex':layerIndex,'operatorValue':evcObject.Eventcorrelation.operator,'serviceTemplateId':evcObject.Service.servicetemplate_id,'evcServiceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name},'Service':{'hostName':evcObject.Service.Host.name,'serviceType':evcObject.Service.service_type,'serviceTemplateId':evcObject.Service.servicetemplate_id,'currentState':currentState,'serviceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name,'usedBy':usedBy}})}});divsToConnect[parentId]=$.map(selectedServicesGroupByParentId[parentId],function(evcElement){return evcElement[0].eventcorrelationId+'_vService'});if(layerIndex===0){$eventCorrelationDivPosition[parentId]=self.drawEventCorrelationPhysicalLayer($parentContainer,selectedServicesGroupByParentId[parentId],parentId)}});$.each(operatorDetails,function(evcId,operator){if(layerIndex===operator[0].Operator.layerIndex){if(layerIndex>1){currentEvcDivPosition={'id':evcId,'positionTop':self.getOptimalTopPositionForOperator($('#layer_'+layerIndex).next(),divsToConnect[evcId]),'height':0,'divsToConnect':divsToConnect[evcId]}}
$eventCorrelationOperatorDivDetails=self.drawOperator('layer_'+layerIndex,(currentEvcDivPosition===null)?$eventCorrelationDivPosition[evcId]:currentEvcDivPosition,operator[0].Operator.operatorValue,operator[0].Operator.evcServiceName,operator[0].Operator.serviceTemplateId,!0);if(layerIndex>1){self.addVServicesHiddenFields('layer_'+layerIndex,divsToConnect[evcId],$eventCorrelationOperatorDivDetails)}
self.drawVirtualService($('#layer_'+(layerIndex+1)),$eventCorrelationOperatorDivDetails,operator[0].Service,divsToConnect[evcId])}})});self.heightAdjustment()},isNewService:function(serviceDivId){var pattern=/^ui-id-\d+$/;return pattern.test(serviceDivId)},removeIllegalCharacters:function(string){return string.replace(/[^\w\d\-_ÄÖÜäöü ]/g,'')}});App.Controllers.EventcorrelationsViewController=Frontend.AppController.extend({components:['Ajaxloader','Status'],$serviceList:null,_initialize:function(){var self=this,idToCheck=null,$clickObject={};this.$serviceList=this.getVar('servicesList');this.EvcHostName=this.getVar('hostName');this.EvcHostId=this.getVar('hostId');this.evcTree=this.getVar('evcTree');this.options={'container':'#evkDrawPad','mainDivClass':'evkWidgetBody'}
if(!$.isEmptyObject(this.evcTree)){self.drawEvcTree(this.evcTree)}else{this.evcTree=[]}
$('.service').mouseenter(function(){var id=$(this).parent().attr('serviceid');var serviceList=self.filterNullValues(self.$serviceList[id]);var html=self.buildTooltipHTML(serviceList,self);var title=serviceList.serviceName;self.appendTooltip(id,title,html)});$('.service').mouseleave(function(){var $el=$('#divSmallBoxes').children();$el.hide(300,function(){$(this).remove()})})},filterNullValues:function(serviceList){for(var key in serviceList){if(serviceList[key]===null){serviceList[key]=''}}
return serviceList},appendTooltip:function(id,title,content){$.smallBox({title:title,content:content,color:'rgba(249, 249, 249, 1)',icon:"fa fa-desktop"});$('.textoFoto').css('color','#000000');$('.foto').css({'color':'#5A5A5A'})},buildTooltipHTML:function(data,self){var status=self.Status.serviceStatusColor(data.currentState);var html='<table class="table table-bordered popoverTable" style="padding:1px;">'+'<tr>'+'<td class="col-md-3 col-xs-3">Host Name</td>'+'<td class="col-md-3 col-xs-3">'+htmlspecialchars(data.hostName)+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Service Name</td>'+'<td class="col-md-3 col-xs-3">'+htmlspecialchars(data.serviceName)+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Description</td>'+'<td class="col-md-3 col-xs-3">'+htmlspecialchars(data.serviceDescription)+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">State</td>'+'<td class="col-md-3 col-xs-3 '+status['class']+'">'+status.human_state+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Output</td>'+'<td class="col-md-3 col-xs-3">'+htmlspecialchars(data.output)+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Long output</td>'+'<td class="col-md-3 col-xs-3">'+htmlspecialchars(data.longOutput)+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Current Attempt</td>'+'<td class="col-md-3 col-xs-3">'+data.currentCheckAttempt+'/'+data.maxCheckAttempts+'</td>'+'</tr>'+'<tr>'+'<td class="col-md-3 col-xs-3">Last Check</td>'+'<td class="col-md-3 col-xs-3">'+data.lastCheck+'</td>'+'</tr>';if(data.activeChecksEnabled==1){html+='<tr><td class=“col-md-3 col-xs-3”>Next Check</td>'+'<td class=“col-md-3 col-xs-3">'+data.nextCheck+'</td>'+'</tr>'}
html+='<tr>'+'<td class="col-md-3 col-xs-3">Last State Change</td>'+'<td class="col-md-3 col-xs-3">'+data.lastStateChange+'</td>'+'</tr>'+'</table>';return html},getSelectedServices:function(uuids){var self=this,serviceObjects=[];$.each(uuids,function(id,uuid){serviceObjects.push($.map(self.$serviceList,function(object){if(object.hostUuid+'|'+object.serviceUuid===uuid){return object}}))});return serviceObjects},drawEventCorrelationPhysicalLayer:function(parentContainer,serviceObjects,evcId){var self=this,colors=['#449D44','#DF8F1D','#C9302C','#92A2A8'],notMonitoredBackgroundColor='#337ab7',$newDiv=$('<div/>',{'id':(evcId!==null)?evcId:_.uniqueId('ui-id-')}),newDivId=$newDiv.attr('id'),$operatorPosition={'positionTop':0,'height':0},serviceObjectCounter=1,divsToConnect=[],parentId=parentContainer.attr('id'),evcTreeLayer=0,serviceDataToAdd={};serviceDataToAdd[newDivId]=[];parentContainer.append($newDiv);$.each(serviceObjects,function(index,object){object=object[0];var disabledClass='';var disabledMessage='';if(object.disabled==='1'){disabledClass=' serviceDisabled disabledIcon';disabledMessage=' (!!!DISABLED!!!)'}
$newDiv.append($('<a/>',{'href':'/services/browser/'+object.serviceId,'class':'txt-color-blueDark','serviceId':object.serviceId}).append($('<div/>',{'class':'service firstLayerService '+disabledClass,'id':newDivId+'_'+serviceObjectCounter}).append($('<div/>',{'class':'serviceStateColor pull-left'}).css('background-color',(object.currentState!==null)?colors[object.currentState]:notMonitoredBackgroundColor)).append($('<div/>',{'class':'serviceInformation'}).append($('<div/>',{'class':'hosttext ellipsis','title':object.hostName}).append('<i class="fa fa-desktop"></i> '+htmlspecialchars(object.hostName))).append($('<div/>',{'class':'servicetext ellipsis','title':htmlspecialchars(object.serviceName+disabledMessage)}).append('<i class="fa fa-'+((object.serviceType==2)?'sitemap fa-fw fa-rotate-90':'gear')+'"></i> '+htmlspecialchars(object.serviceName)))).append($('<input/>',{'type':'hidden','value':object.serviceId,'name':parentId+'['+newDivId+'][children]['+serviceObjectCounter+']'}))));divsToConnect.push(newDivId+'_'+serviceObjectCounter);if(evcId===null){serviceDataToAdd[newDivId].push(self.prepareSelectedServicesForEvcTreeUpdate(object,newDivId,newDivId+'_'+serviceObjectCounter,null,null))}
serviceObjectCounter++});if(self.evcTree[evcTreeLayer]===undefined&&evcId===null){self.evcTree[evcTreeLayer]=serviceDataToAdd}else{if(evcId===null){$.extend(!0,self.evcTree[evcTreeLayer],serviceDataToAdd)}}
$operatorPosition={'positionTop':parseInt(($newDiv.position().top-3),10),'height':$newDiv.height(),'id':newDivId,'divsToConnect':divsToConnect};return $operatorPosition},heightAdjustment:function(){$('.globalLayerContainer').not('#layer_1').css('height',parseInt($('#layer_1').outerHeight(),10)+'px')},drawOperator:function(serviceLayerId,operatorDetails,operatorValue,vServiceName,vServiceTemplateId,reDraw){var self=this,connection=null,operatorHeight=38,$operatorDetails={},parentContainer=$('#'+serviceLayerId).next(),virtualServiceObject={},currentLayerNumber=serviceLayerId.replace(/layer_/,'');operatorDetails.id=(operatorDetails.id===null)?_.uniqueId('ui-id-'):operatorDetails.id;$.when(parentContainer.append($('<div/>',{'class':'operator txt-color-white','id':operatorDetails.id+'_nodeOperator'}).css({'position':'absolute','top':parseInt((operatorDetails.positionTop+operatorDetails.height/2-operatorHeight/2),10)+'px'}).text(operatorValue)).append($('<input/>',{'type':'hidden','value':operatorValue,'name':serviceLayerId+'['+operatorDetails.id+'][operator]'})).append($('<input/>',{'type':'hidden','value':vServiceName,'name':serviceLayerId+'['+operatorDetails.id+'][vServiceName]'})).append($('<input/>',{'type':'hidden','value':vServiceTemplateId,'name':serviceLayerId+'['+operatorDetails.id+'][vServiceTemplateId]'}))).done(function(){var positionOptions=$('#'+operatorDetails.id+'_nodeOperator').position();$operatorDetails={'top':parseInt(positionOptions.top,10),'left':parseInt(positionOptions.left,10),'id':operatorDetails.id+'_nodeOperator','firstLayerServicesDivId':operatorDetails.id};$.each(operatorDetails.divsToConnect,function(index,divId){connection=new $.connect('#'+divId,'#'+operatorDetails.id+'_nodeOperator',self.options)})});return $operatorDetails},addNewServiceLayer:function(newLayerId){var $addVServiceButton=$('#layer_1').find('.addLayerBtn:first-child').clone(!0)
$('#evkDrawPad').append($('<div/>',{'class':'layerContainer globalLayerContainer ','id':newLayerId}).append($addVServiceButton),$('<div/>',{'class':'nodeLayerContainer globalLayerContainer',}))},layerAlreadyExists:function(idToCheck){if($('#'+idToCheck).length){return!0}
return!1},drawVirtualService:function(parentContainer,operatorDetails,virtualServiceObject,serviceListForHiddenFields){var self=this,colors=['#449D44','#DF8F1D','#C9302C','#92A2A8'],notMonitoredBackgroundColor='#337ab7',connection=null;parentContainer.append($('<a/>',{'href':'/services/browser/'+virtualServiceObject.serviceId,'class':'txt-color-blueDark','serviceId':virtualServiceObject.serviceId}).append($('<div/>',{'class':'service','id':operatorDetails.firstLayerServicesDivId+'_vService','top_position':operatorDetails.top,'nodeId':operatorDetails.firstLayerServicesDivId}).append($('<div/>',{'class':'serviceStateColor pull-left'}).css('background',(virtualServiceObject.currentState===null)?notMonitoredBackgroundColor:colors[virtualServiceObject.currentState])).append($('<div/>',{'class':'serviceInformation'}).append($('<div/>',{'class':'hosttext ellipsis','title':virtualServiceObject.hostName}).append('<i class="fa fa-desktop"></i> '+virtualServiceObject.hostName)).append($('<div/>',{'class':'servicetext ellipsis','title':virtualServiceObject.serviceName}).append('<i class="fa fa-'+((virtualServiceObject.serviceType==1)?'gear':'sitemap fa-fw fa-rotate-90 txt-color-blue')+'"></i> '+virtualServiceObject.serviceName))).append($('<input/>',{'type':'hidden','disabled':!0,'value':virtualServiceObject.serviceName,'selectedValue':operatorDetails.firstLayerServicesDivId+'_vService','name':parentContainer.attr('id')+'['+operatorDetails.firstLayerServicesDivId+']['+operatorDetails.id+']'})).css({'position':'absolute','top':parseInt(operatorDetails.top,10)+'px'})));connection=new $.connect('#'+operatorDetails.id,'#'+operatorDetails.firstLayerServicesDivId+'_vService',self.options)},isFirstLayer:function(layerId){if(layerId==='layer_1'){return!0}
return!1},getOptimalTopPositionForOperator:function($operatorLayerDivElement,selectedServicesArray){var midPosition=midPositionWithoutHHOperator=elementTopPosition=0,operatorHeight=38;var operatorDivChildren=$operatorLayerDivElement.children('.operator');var convertedIds=selectedServicesArray.map(function(element){return'#'+element});var topPositionArray=$.map($(convertedIds.join()),function(element){return parseInt($(element).attr('top_position'),10)});var topPositionArrayFromOperatorDiv=[];var lowestPosition=Math.max.apply(null,topPositionArray);var highestPosition=Math.min.apply(null,topPositionArray);midPositionWithoutHHOperator=parseInt(highestPosition+((lowestPosition-highestPosition)/2),10);midPosition=parseInt(midPositionWithoutHHOperator+operatorHeight/2,10);if(operatorDivChildren.length===0){return midPosition}
$.each(operatorDivChildren,function(operatorIndex,operator){topPositionArrayFromOperatorDiv.push($(operator).position().top)});for(var i=0;i<100000;i++){var conflict=!1;$.each(topPositionArrayFromOperatorDiv,function(indexN,operatorTopPosition){if(midPosition+i>operatorTopPosition-operatorHeight/2-2&&midPosition+i<operatorTopPosition+operatorHeight+operatorHeight/2+2){conflict=!0;return}});if(!conflict){return midPosition+i}
var conflict=!1;$.each(topPositionArrayFromOperatorDiv,function(indexN,operatorTopPosition){if(midPosition-i>operatorTopPosition-operatorHeight/2-2&&midPosition-i<operatorTopPosition+operatorHeight+operatorHeight/2+2){conflict=!0;return}});if(!conflict){return midPosition-i}}
return midPosition},drawEvcTree:function(evcTree){var self=this,selectedServicesGroupByParentId={},$eventCorrelationDivPosition={},operatorDetails={},divsToConnect={},currentEvcDivPosition=null;$.each(evcTree,function(layerIndex,eventCorrelationArray){if(!self.layerAlreadyExists('layer_'+(layerIndex+1))){self.addNewServiceLayer('layer_'+(layerIndex+1))}
$parentContainer=$('#layer_'+(layerIndex+1));$.each(eventCorrelationArray,function(parentId,serviceWithOperatorDetails){selectedServicesGroupByParentId[parentId]=[];$.each(serviceWithOperatorDetails,function(index,evcObject){var currentState=(self.$serviceList[evcObject.Service.id]!==undefined)?self.$serviceList[evcObject.Service.id].currentState:null;selectedServicesGroupByParentId[parentId].push([{'serviceId':evcObject.Service.id,'hostName':evcObject.Service.Host.name,'serviceType':evcObject.Service.service_type,'currentState':currentState,'serviceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name,'eventcorrelationId':evcObject.Eventcorrelation.id,'disabled':evcObject.Service.disabled,}]);if(evcObject.Eventcorrelation.operator!==null){operatorDetails[evcObject.Eventcorrelation.id]=[];operatorDetails[evcObject.Eventcorrelation.id].push({'Operator':{'layerIndex':layerIndex,'operatorValue':evcObject.Eventcorrelation.operator,'serviceTemplateId':evcObject.Service.servicetemplate_id,'evcServiceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name},'Service':{'serviceId':evcObject.Service.id,'hostName':evcObject.Service.Host.name,'serviceType':evcObject.Service.service_type,'serviceTemplateId':evcObject.Service.servicetemplate_id,'currentState':currentState,'serviceName':(evcObject.Service.name)?evcObject.Service.name:evcObject.Service.Servicetemplate.name,}})}});divsToConnect[parentId]=$.map(selectedServicesGroupByParentId[parentId],function(evcElement){return evcElement[0].eventcorrelationId+'_vService'});if(layerIndex===0){$eventCorrelationDivPosition[parentId]=self.drawEventCorrelationPhysicalLayer($parentContainer,selectedServicesGroupByParentId[parentId],parentId)}});$.each(operatorDetails,function(evcId,operator){if(layerIndex===operator[0].Operator.layerIndex){if(layerIndex>1){currentEvcDivPosition={'id':evcId,'positionTop':self.getOptimalTopPositionForOperator($('#layer_'+layerIndex).next(),divsToConnect[evcId]),'height':0,'divsToConnect':divsToConnect[evcId]}}
$eventCorrelationOperatorDivDetails=self.drawOperator('layer_'+layerIndex,(currentEvcDivPosition===null)?$eventCorrelationDivPosition[evcId]:currentEvcDivPosition,operator[0].Operator.operatorValue,operator[0].Operator.evcServiceName,operator[0].Operator.serviceTemplateId,!0);self.drawVirtualService($('#layer_'+(layerIndex+1)),$eventCorrelationOperatorDivDetails,operator[0].Service,divsToConnect[evcId])}})});self.heightAdjustment()},});App.Controllers.SynchronisationsIndexController=Frontend.AppController.extend({$lastPercent:0,_initialize:function(){var self=this;setInterval(function(){self.triggerSync()},1000);$('#start-sync').click(function(){self.$lastPercent=0;$('#progrees-value').text(self.$lastPercent+'%').css('width',self.$lastPercent+'%').attr('aria-valuenow',self.$lastPercent);$('#start-sync').attr('disabled','disabled');$.ajax({url:'/idoit_module/Synchronisations/sync',success:function(){self.triggerSync()}.bind(self)})})},triggerSync:function(){var self=this;$.ajax({url:'/idoit_module/Synchronisations/getInfo',dataType:'json',success:function(response){if(response.length==0)return;if(response.finished&&self.$lastPercent==100){$('#start-sync').removeAttr('disabled');return}
if(!response.finished){$('#start-sync').attr('disabled','disabled')}
$('#sync-log').html('');self.$lastPercent=0;$('.progressbar-holder').fadeIn();for(var i in response){if(typeof response[i].task==='undefined')continue;if(self.$lastPercent<parseInt(response[i].percent)){self.$lastPercent=parseInt(response[i].percent)}
$('#sync-log').append('<tr><td>'+response[i].task+'</td>'+'<td><i class="fa fa-'+(response[i].status=='1'?'check':'refresh fa-spin')+'"></i></td>'+'<td>'+response[i].created+'</td></tr>')}
$('#progrees-value').text(self.$lastPercent+'%').css('width',self.$lastPercent+'%').attr('aria-valuenow',self.$lastPercent)}})}});App.Controllers.ConfigurationsSelectItemsController=Frontend.AppController.extend({_initialize:function(){$('input:checkbox').click(function(){var $this=$(this);if($this.prop('checked')===!0){$('#object_'+$this.attr('object-id')).show()}else{$('#object_'+$this.attr('object-id')).hide()}})}});App.Controllers.ConfigurationsEditController=Frontend.AppController.extend({_initialize:function(){if($('#ConfigurationSyncAdditionalObjecttypes').is(':checked')=='1'){$('#additionalObjectsBox').show();$('#reportIdBox').show()}
if($('#ConfigurationSyncAdditionalInformations').is(':checked')=='1'){$('#additionalInfoReportIdBox').show()}
$('#ConfigurationSyncAdditionalObjecttypes').change(function(){if($('#ConfigurationSyncAdditionalObjecttypes').is(':checked')=='0'){$('#additionalObjectsBox').hide();$('#reportIdBox').hide()}else{$('#additionalObjectsBox').show();$('#reportIdBox').show()}}.bind(this));$('#ConfigurationSyncAdditionalInformations').change(function(){if($('#ConfigurationSyncAdditionalInformations').is(':checked')=='0'){$('#additionalInfoReportIdBox').hide()}else{$('#additionalInfoReportIdBox').show()}}.bind(this))}});App.Controllers.ConfigurationsSelectObjectsController=Frontend.AppController.extend({_initialize:function(){$('input:checkbox').click(function(){var $this=$(this);if($this.prop('checked')===!0){$('#objecttype_'+$this.attr('objecttype-id')).show()}else{$('#objecttype_'+$this.attr('objecttype-id')).hide()}})}});App.Controllers.ConfigurationsAddController=Frontend.AppController.extend({_initialize:function(){$('#ConfigurationSyncAdditionalObjecttypes').change(function(){if($('#ConfigurationSyncAdditionalObjecttypes').is(':checked')=='0'){$('#additionalObjectsBox').hide();$('#reportIdBox').hide()}else{$('#additionalObjectsBox').show();$('#reportIdBox').show()}}.bind(this));$('#ConfigurationSyncAdditionalInformations').change(function(){if($('#ConfigurationSyncAdditionalInformations').is(':checked')=='0'){$('#additionalInfoReportIdBox').hide()}else{$('#additionalInfoReportIdBox').show()}}.bind(this))}});App.Controllers.ScansIndexController=Frontend.AppController.extend({hostId:null,$ajaxLoader:null,$formContent:null,$healthSelectbox:null,$processSelectbox:null,$serviceSelectbox:null,ajax1:!1,ajax2:!1,$missingTemplatesTable:null,_initialize:function(){this.agentId=0;this.hostId=this.getVar('hostId');this.$ajaxLoader=$('#loader');this.$formContent=$('#formContent');this.$healthSelectbox=$('#ScanHealth');this.$processSelectbox=$('#ScanPs');this.$serviceSelectbox=$('#ScanServices');this.$missingTemplatesTable=$('#missingTemplates tr:last');var self=this;$('#execute-discovery').click(function(){if($('#agent-id').val()==-1){window.location.href="/mk_module/snmp/index/"+self.hostId}else{self.agentId=$('#agent-id').val();self.executeRemoteDiscovery()}})},executeRemoteDiscovery:function($agentId){this.$ajaxLoader.html('<center><i class="fa fa-cog fa-4x fa-spin"></i><br /><span>'+this.getVar('executing_remote_discovery')+'</span></center>');this.ajaxHealthList(function(response){for(var key in response.responseJSON.discoveryResult.result){this.$healthSelectbox.append('<option value="'+key+'">'+response.responseJSON.discoveryResult.result[key].description+'</option>')}
if(sizeof(response.responseJSON.discoveryResult.missing_template)>0){for(var key in response.responseJSON.discoveryResult.missing_template){this.$missingTemplatesTable.after('<tr><td>'+response.responseJSON.discoveryResult.missing_template[key].checktype+'</td><td class="text-info">'+response.responseJSON.discoveryResult.missing_template[key].item+'</td><td>'+response.responseJSON.discoveryResult.missing_template[key].params+'</td><td class="txt-color-green">'+response.responseJSON.discoveryResult.missing_template[key].description+'</td></tr>')}
$('#missingTemplateContainer').show()}
this.ajax1=!0;if(this.ajax1&&this.ajax2){this.$ajaxLoader.hide();this.$formContent.show();$('.chosen-container').css('width','100%');this.$healthSelectbox.trigger("chosen:updated");this.$processSelectbox.trigger("chosen:updated");this.$serviceSelectbox.trigger("chosen:updated")}}.bind(this));this.ajaxProcessList(function(response){for(var key in response.responseJSON.MkProcesses.ps){this.$processSelectbox.append('<option value="'+key+'">'+response.responseJSON.MkProcesses.ps[key].description+'</option>')}
for(var key in response.responseJSON.MkProcesses.services){this.$serviceSelectbox.append('<option value="'+key+'">'+response.responseJSON.MkProcesses.services[key].description+'</option>')}
this.ajax2=!0;if(this.ajax1&&this.ajax2){this.$ajaxLoader.hide();this.$formContent.show();$('.chosen-container').css('width','100%');this.$healthSelectbox.trigger("chosen:updated");this.$processSelectbox.trigger("chosen:updated");this.$serviceSelectbox.trigger("chosen:updated")}}.bind(this))},ajaxHealthList:function(callback){$.ajax({url:"/mk_module/scans/ajaxHealthList/"+encodeURIComponent(this.hostId)+".json",data:{agentId:this.agentId},type:"POST",cache:!1,error:function(){},success:function(){},complete:callback})},ajaxProcessList:function(callback){$.ajax({url:"/mk_module/scans/ajaxProcessList/"+encodeURIComponent(this.hostId)+".json",data:{agentId:this.agentId},type:"POST",cache:!1,error:function(){},success:function(){},complete:callback})}});App.Controllers.SnmpExecuteController=Frontend.AppController.extend({hostId:null,$objectsSelectbox:null,$loader:null,$missingTemplatesTable:null,_initialize:function(){this.hostId=this.getVar('hostId');this.$loader=$('#loader');this.$missingTemplatesTable=$('#missingTemplates tr:last');this.$objectsSelectbox=$('#MksnmpServiceHash');var self=this;this.ajaxSnmp(function(response){for(var key in response.responseJSON.snmpResult.result){self.$objectsSelectbox.append('<option value="'+key+'">'+response.responseJSON.snmpResult.result[key].description+'</option>')}
self.$loader.hide();$('#formContent').show();self.$objectsSelectbox.trigger("chosen:updated");if(sizeof(response.responseJSON.snmpResult.missing_template)>0){for(var key in response.responseJSON.snmpResult.missing_template){self.$missingTemplatesTable.after('<tr><td>'+response.responseJSON.snmpResult.missing_template[key].checktype+'</td><td class="text-info">'+response.responseJSON.snmpResult.missing_template[key].item+'</td><td>'+response.responseJSON.snmpResult.missing_template[key].params+'</td><td class="txt-color-green">'+response.responseJSON.snmpResult.missing_template[key].description+'</td></tr>')}
$('#missingTemplateContainer').show()}})},ajaxSnmp:function(callback){$.ajax({url:"/mk_module/snmp/executeSnmpDiscoveryByAjax/"+encodeURIComponent(this.hostId)+".json",type:"POST",cache:!1,error:function(){},success:function(){},complete:callback})}});App.Controllers.SnmpIndexController=Frontend.AppController.extend({_initialize:function(){this.renderForm($('#MksnmpVersion').val());var self=this;$('#MksnmpVersion').change(function(){self.renderForm($(this).val())});if(this.getVar('clearUserPassword')){setTimeout(function(){$('#MksnmpUsername').val('');$('#MksnmpPassword').val('')},500)}},renderForm:function(snmpVersion){if(snmpVersion==1||snmpVersion==2){$('#v1_v2_options').show();$('#v3_options').hide()}else{$('#v1_v2_options').hide();$('#v3_options').show()}}});App.Controllers.MkLogfileShowCheckMKLogfileController=Frontend.AppController.extend({components:['Masschange','Ajaxloader'],arrayKeys:[],_initialize:function(){this.Ajaxloader.setup();this.Masschange.setup({'controller':'mkLogfile','group':'servicegroups','checkboxattr':'servicename','storeUuidsAsArray':!0});var self=this;$('#deleteAllSelectedEntries').click(function(){self.arrayKeys.length=0;$('.massChange').each(function(arrayKeys){if($(this).prop('checked')){self.arrayKeys.push($(this).attr('array-index'))}})
self.Ajaxloader.show();$.ajax({url:"/mk_module/mk_logfile/modifyCheckMkLogfile/.json",type:"POST",cache:!1,data:({host_uuid:$('#hostUuid').val(),service_name:$('#serviceName').val(),arrayKeys:self.arrayKeys}),error:function(){},success:function(){},complete:function(response){self.Ajaxloader.hide();location.reload()}.bind(self)})})}});App.Controllers.ConfigsIndexController=Frontend.AppController.extend({_initialize:function(){$('#saveContent').click(function(){$.post("/nagios_module/configs/saveConfig",{configfile:$('#ConfigConfigfile').val(),content:strip_tags($('.config_editor').html(),'<br>')},function(){$("html, body").animate({scrollTop:0},"slow");$('#flashMessage').show()})})},});App.Controllers.CmdIndexController=Frontend.AppController.extend({_initialize:function(){$('#CmdCommand').change(function(){$('.api_structure_container').hide();$('#'+$(this).val()).show()})},})