angular.module('openITCOCKPIT').service('SortService',function(){var _callback=null;var sort=null;var direction=null;var initialize=!0;var triggerCallback=function(){if(_callback!==null){_callback()}};return{setCallback:function(callback){_callback=callback},triggerReload:triggerCallback,getDirection:function(){return direction},getSort:function(){return sort},setDirection:function(value){direction=value},setSort:function(value){sort=value},setInitialize:function(value){initialize=value}}});angular.module('openITCOCKPIT').service('SudoService',function($interval){var _connection=null;var _uniqid=null;var _url='';var _key='';var _hasError=!1;var _onSuccess=function(event){console.info(event)};var _onError=function(event){_hasError=!0;console.error(event)};var _onResponse=function(event){};var _onDispatch=function(event){};var keepAlive=function(){_send(JSON.stringify({task:'keepAlive',data:'',uniqid:_uniqid,key:_key}))};var _connect=function(){_connection=new WebSocket(_url);_connection.onopen=_onResponse;_connection.onmessage=_parseResponse;_connection.onerror=_onError;var keepAliveInterval=$interval(function(){keepAlive()},30000)};var _send=function(json){_connection.send(json)};var _parseResponse=function(event){var transmitted=JSON.parse(event.data);switch(transmitted.type){case 'connection':_uniqid=transmitted.uniqid;_onSuccess(event);break;case 'response':if(_uniqid===transmitted.uniqid){_onResponse(event)}
break;case 'dispatcher':_onDispatch(event);break;case 'keepAlive':break}};return{toJson:function(task,data){var jsonArr=[];jsonArr=JSON.stringify({task:task,data:data,uniqid:_uniqid,key:_key});return jsonArr},setApiKey:function(key){_key=key},setUrl:function(url){_url=url},connect:function(){_connect()},onSuccess:function(callback){_onSuccess=callback},onError:function(callback){_onError=callback},onResponse:function(callback){_onResponse=callback},onDispatch:function(callback){_onDispatch=callback},send:function(json){_send(json)},hasError:function(){return _hasError}}});angular.module('openITCOCKPIT').service('PushNotificationsService',function($interval){var _connection=null;var _url='';var _key='';var _userId=0;var _uuid=null;var _success=!1;var _onSuccess=function(event){_success=!0;var data=JSON.parse(event.data);console.info('Connection to push notification service established successfully');_uuid=data.data.uuid;var browserUuid=localStorage.getItem('browserUuid');if(browserUuid===null){browserUuid=UUID.generate();localStorage.setItem('browserUuid',browserUuid)}
_send(JSON.stringify({task:'register',key:_key,uuid:_uuid,data:{userId:_userId,browserUuid:browserUuid}}))};var _onError=function(event){_success=!1;console.error(event)};var _onResponse=function(event){};var _onDispatch=function(event){};var keepAlive=function(){_send(JSON.stringify({task:'keepAlive',key:_key,uuid:_uuid}))};var _connect=function(){_connection=new WebSocket(_url);_connection.onopen=_onResponse;_connection.onmessage=_parseResponse;_connection.onerror=_onError;var keepAliveInterval=$interval(function(){if(_success){keepAlive()}},30000)};var _send=function(json){_connection.send(json)};var _parseResponse=function(event){var transmitted=JSON.parse(event.data);switch(transmitted.type){case 'connection':_onSuccess(event);break;case 'message':_onResponse(event);break;case 'keepAlive':break}};return{toJson:function(task,data){var jsonArr=[];jsonArr=JSON.stringify({task:task,data:data,uniqid:_uniqid,key:_key});return jsonArr},setUserId:function(userId){_userId=userId},setApiKey:function(key){_key=key},setUrl:function(url){_url=url},connect:function(){_connect()},onSuccess:function(callback){_onSuccess=callback},onError:function(callback){_onError=callback},onResponse:function(callback){_onResponse=callback},onDispatch:function(callback){_onDispatch=callback},send:function(json){_send(json)}}});angular.module('openITCOCKPIT').service('RedirectService',function($state,NotyService){return{redirectWithFallback:function(fallbackState){if($state.previous.name!==""&&$state.previous.url!=="^"){$state.go($state.previous.name,$state.previous.params).then(function(){NotyService.scrollTop()})}else{$state.go(fallbackState).then(function(){NotyService.scrollTop()})}}}});angular.module('openITCOCKPIT').service('UuidService',function(){return{v4:function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16)})},isUuid:function(uuid){var RegExObject=new RegExp('([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})','i');return uuid.match(RegExObject)!==null}}});angular.module('openITCOCKPIT').service('BBParserService',function(){return{parse:function(bbCode){var resString=bbCode;resString=resString.replace(/(?:\r\n|\r|\n)/g,'<br />');resString=resString.replace(/\[b\]/gi,'<strong>');resString=resString.replace(/\[\/b\]/gi,'</strong>');resString=resString.replace(/\[i\]/gi,'<i>');resString=resString.replace(/\[\/i\]/gi,'</i>');resString=resString.replace(/\[u\]/gi,'<u>');resString=resString.replace(/\[\/u\]/gi,'</u>');resString=resString.replace(/\[left\]/gi,'<div class="text-left">');resString=resString.replace(/\[\/left\]/gi,'</div>');resString=resString.replace(/\[right\]/gi,'<div class="text-right">');resString=resString.replace(/\[\/right\]/gi,'</div>');resString=resString.replace(/\[center\]/gi,'<div class="text-center">');resString=resString.replace(/\[\/center\]/gi,'</div>');resString=resString.replace(/\[justify\]/gi,'<div class="text-justify">');resString=resString.replace(/\[\/justify\]/gi,'</div>');resString=resString.replace(/\[color ?= ?'(#[\w]{6})' ?\]/gi,'<span style="color:$1">');resString=resString.replace(/\[\/color\]/gi,'</span>');resString=resString.replace(/\[text ?= ?'([\w\-]+)' ?\]/gi,'<span style="font-size:$1">');resString=resString.replace(/\[\/text\]/gi,'</span>');resString=resString.replace(/\[url ?= ?'([\w\-:\/\[\]\. ]+)' ?tab ?\]/gi,'<a href="$1" target="_blank">');resString=resString.replace(/\[url ?= ?'([\w\-:\/\[\]\. ]+)' ?\]/gi,'<a href="$1">');resString=resString.replace(/\[\/url\]/gi,'</a>');return resString}}});angular.module('openITCOCKPIT').service('StatusHelperService',function(){return{getHoststatusTextColor:function(currentState){switch(currentState){case 0:case '0':return'up';case 1:case '1':return'down';case 2:case '2':return'unreachable'}
return'txt-primary'},getServicestatusTextColor:function(currentState){switch(currentState){case 0:case '0':return'ok';case 1:case '1':return'warning';case 2:case '2':return'critical';case 3:case '3':return'unknown'}
return'txt-primary'}}});angular.module('openITCOCKPIT').service('MassChangeService',function(){var selected={};var selectedCounter=0;return{setSelected:function(_selected){selected={};for(var id in _selected){if(_selected[id]){selected[id]=id}}
selectedCounter=Object.keys(selected).length},getSelected:function(){return selected},clearSelection:function(){selected={};selectedCounter=0},getCount:function(){return selectedCounter}}});angular.module('openITCOCKPIT').service('LocalStorageService',function(){return{hasItem:function(key){return window.localStorage.getItem(key)===null},getItem:function(key){return window.localStorage.getItem(key)},getItemWithDefault:function(key,defaultValue){var val=window.localStorage.getItem(key);if(val===null){return defaultValue}
return val},setItem:function(key,value){window.localStorage.setItem(key,value)},deleteItem:function(key){window.localStorage.removeItem(key)}}});angular.module('openITCOCKPIT').service('NotyService',function(){var NotyMsg=function(options){new Noty({theme:'metroui',type:options.type,text:options.message,timeout:options.timeout}).show()};return{scrollTop:function(){$('body,html').animate({scrollTop:0},800);return!1},genericSuccess:function(options){options=options||{};options.message=options.message||'Data saved successfully';options.timeout=options.timeout||3500;options.type='success';NotyMsg(options)},genericError:function(options){options=options||{};options.message=options.message||'Error while saving data';options.timeout=options.timeout||3500;options.type='error';NotyMsg(options)},genericWarning:function(options){options=options||{};options.message=options.message||'Warning - something unexpected happened';options.timeout=options.timeout||3500;options.type='warning';NotyMsg(options)},deleteSuccess:function(options){options=options||{};options.message=options.message||'Record deleted successfully';options.timeout=options.timeout||3500;options.type='success';NotyMsg(options)},deleteError:function(options){options=options||{};options.message=options.message||'Error while deleting record';options.timeout=options.timeout||3500;options.type='error';NotyMsg(options)}}});angular.module('openITCOCKPIT').service('AvailabilityColorCalculationService',function(){var defaultColors={green:'#449D44',orange:'#eaba0b',red:'#C9302C'};var hexToRgb=function(hex){var red=parseInt(hex.substr(1,2),16);var green=parseInt(hex.substr(3,2),16);var blue=parseInt(hex.substr(5,2),16);return[red,green,blue]};var rgbToHex=function(red,green,blue){red=Number(red).toString(16);if(red.length<2){red="0"+red}
green=Number(green).toString(16);if(green.length<2){green="0"+green}
blue=Number(blue).toString(16);if(blue.length<2){blue="0"+blue}
return red+green+blue};return{getBackgroundColor:function(currentAvailabilityInPercent){var currentAvailabilityInPercentFloat=(currentAvailabilityInPercent/100).toFixed(3);var weight1=(1-currentAvailabilityInPercentFloat).toFixed(3);var weight2=currentAvailabilityInPercentFloat;if(currentAvailabilityInPercent>=50){var colorFrom=hexToRgb(defaultColors.orange);var colorTo=hexToRgb(defaultColors.green)}else{var colorFrom=hexToRgb(defaultColors.red);var colorTo=hexToRgb(defaultColors.orange)}
var colors=[Math.round(colorFrom[0]*weight1+colorTo[0]*weight2),Math.round(colorFrom[1]*weight1+colorTo[1]*weight2),Math.round(colorFrom[2]*weight1+colorTo[2]*weight2)];return'#'+rgbToHex(colors[0],colors[1],colors[2])}}});angular.module('openITCOCKPIT').service('QueryStringService',function(){return{getCakeId:function(){var url=window.location.href;url=url.split('/');var id=url[url.length-1];id=parseInt(id,10);return id},getCakeIds:function(){var url=window.location.href;var ids=[];url=url.split('/');if(url.length>5){for(var i=5;i<url.length;i++){if(isNaN(url[i])===!1&&url[i]!==null&&url[i]!==''){ids.push(parseInt(url[i],10))}}}
return ids},getValue:function(varName,defaultReturn){defaultReturn=(typeof defaultReturn==='undefined')?null:defaultReturn;var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var query=parseUri(sourceUrl).queryKey;if(query.hasOwnProperty(varName)){return query[varName]}
return defaultReturn},getIds:function(varName,defaultReturn){defaultReturn=(typeof defaultReturn==='undefined')?null:defaultReturn;try{var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var url=new URL(sourceUrl);var serviceIds=url.searchParams.getAll(varName);if(serviceIds.length>0){return serviceIds}
return defaultReturn}catch(e){var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var urlString=sourceUrl;var peaces=urlString.split(varName);var ids=[];for(var i=0;i<peaces.length;i++){if(peaces[i].charAt(0)==='='){var currentId='';for(var k=0;k<peaces[i].length;k++){var currentChar=peaces[i].charAt(k);if(currentChar!=='='){if(currentChar==='&'){break}
currentId=currentId+currentChar}}
ids.push(currentId)}}
if(ids.length>0){return ids}
return defaultReturn}},hasValue:function(varName){var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var query=parseUri(sourceUrl).queryKey;return query.hasOwnProperty(varName)},hoststate:function(){var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var query=parseUri(sourceUrl).queryKey;var states={up:!1,down:!1,unreachable:!1};for(var key in query){if(key==='filter[Hoststatus.current_state][0]'){states.up=!0}
if(key==='filter[Hoststatus.current_state][1]'){states.down=!0}
if(key==='filter[Hoststatus.current_state][2]'){states.unreachable=!0}}
return states},servicestate:function(){var sourceUrl=parseUri(decodeURIComponent(window.location.href)).source;if(sourceUrl.includes('/ng/#!/')){sourceUrl=sourceUrl.replace('/ng/#!','')}
var query=parseUri(sourceUrl).queryKey;var states={ok:!1,warning:!1,critical:!1,unknown:!1};for(var key in query){if(key==='filter[Servicestatus.current_state][0]'){states.ok=!0}
if(key==='filter[Servicestatus.current_state][1]'){states.warning=!0}
if(key==='filter[Servicestatus.current_state][2]'){states.critical=!0}
if(key==='filter[Servicestatus.current_state][3]'){states.unknown=!0}}
return states}}});angular.module('openITCOCKPIT').service('BlinkService',function($interval){var objects={};var interval=null;var period=5000;interval=$interval(function(){for(var i in objects){objects[i]()}},period);return{registerNewObject:function(uuid,callback){if(!objects.hasOwnProperty(uuid)){objects[uuid]=callback}},unregisterObject:function(uuid){if(objects.hasOwnProperty(uuid)){delete objects[uuid]}}}});angular.module('openITCOCKPIT').service('MapItemReloadService',function($interval,$http){var items={};var interval=null;var refreshInterval=0;var loadData=function(){var postData=[];for(var uuid in items){postData.push({'objectId':items[uuid].item.object_id,'mapId':items[uuid].item.map_id,'type':items[uuid].item.type,'uuid':uuid})}
$http.post("/map_module/mapeditors/mapitemMulti.json?angular=true",{items:postData,disableGlobalLoader:!0}).then(function(result){var data=result.data.mapitems;for(var uuid in items){if(data.hasOwnProperty(uuid)){items[uuid].callback({data:data[uuid]})}}})};var startInterval=function(){if(refreshInterval>0){interval=$interval(function(){loadData()},refreshInterval)}};return{registerNewItem:function(uuid,item,callback){if(!items.hasOwnProperty(uuid)){items[uuid]={item:item,callback:callback}}
if(interval===null){startInterval()}},unregisterItem:function(uuid){if(items.hasOwnProperty(uuid)){delete items[uuid]}
if(Object.keys(items).length===0){if(interval!==null){$interval.cancel(interval);interval=null}}},setRefreshInterval:function(value){if(value>0&&value!=refreshInterval){refreshInterval=value;if(interval!==null){$interval.cancel(interval);interval=null}
startInterval()}}}})